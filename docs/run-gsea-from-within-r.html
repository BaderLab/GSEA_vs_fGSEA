<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Run GSEA from within R | Comparison of GSEA and fGSEA</title>
  <meta name="description" content="These are example R Notebooks comparing GSEA to fGSEA" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Run GSEA from within R | Comparison of GSEA and fGSEA" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These are example R Notebooks comparing GSEA to fGSEA" />
  <meta name="github-repo" content="risserlin/GSEA_vs_fGSEA" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Run GSEA from within R | Comparison of GSEA and fGSEA" />
  
  <meta name="twitter:description" content="These are example R Notebooks comparing GSEA to fGSEA" />
  

<meta name="author" content="Ruth Isserlin" />


<meta name="date" content="2025-04-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="run-fgsea-from-within-r.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Index</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Comparing GSEA and fGSEA</a></li>
<li class="chapter" data-level="3" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html"><i class="fa fa-check"></i><b>3</b> Run GSEA from within R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#load-in-required-libraries"><i class="fa fa-check"></i><b>3.1</b> Load in required libraries</a></li>
<li class="chapter" data-level="3.2" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#configurable-parameters"><i class="fa fa-check"></i><b>3.2</b> Configurable Parameters</a></li>
<li class="chapter" data-level="3.3" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#download-the-latest-pathway-definition-file"><i class="fa fa-check"></i><b>3.3</b> Download the latest pathway definition file</a></li>
<li class="chapter" data-level="3.4" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#run-gsea"><i class="fa fa-check"></i><b>3.4</b> Run GSEA</a></li>
<li class="chapter" data-level="3.5" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#timing"><i class="fa fa-check"></i><b>3.5</b> Timing</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="run-fgsea-from-within-r.html"><a href="run-fgsea-from-within-r.html"><i class="fa fa-check"></i><b>4</b> Run fGSEA from within R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="run-fgsea-from-within-r.html"><a href="run-fgsea-from-within-r.html#load-in-required-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Load in required libraries</a></li>
<li class="chapter" data-level="4.2" data-path="run-fgsea-from-within-r.html"><a href="run-fgsea-from-within-r.html#function-to-write-out-fgsea-results"><i class="fa fa-check"></i><b>4.2</b> function to write out fGSEA results</a></li>
<li class="chapter" data-level="4.3" data-path="run-fgsea-from-within-r.html"><a href="run-fgsea-from-within-r.html#configurable-parameters-1"><i class="fa fa-check"></i><b>4.3</b> Configurable Parameters</a></li>
<li class="chapter" data-level="4.4" data-path="run-fgsea-from-within-r.html"><a href="run-fgsea-from-within-r.html#download-the-latest-pathway-definition-file-1"><i class="fa fa-check"></i><b>4.4</b> Download the latest pathway definition file</a></li>
<li class="chapter" data-level="4.5" data-path="run-fgsea-from-within-r.html"><a href="run-fgsea-from-within-r.html#run-fgsea"><i class="fa fa-check"></i><b>4.5</b> Run fGSEA</a></li>
<li class="chapter" data-level="4.6" data-path="run-fgsea-from-within-r.html"><a href="run-fgsea-from-within-r.html#timing-1"><i class="fa fa-check"></i><b>4.6</b> Timing</a></li>
<li class="chapter" data-level="4.7" data-path="run-fgsea-from-within-r.html"><a href="run-fgsea-from-within-r.html#results-presented-as-r-table"><i class="fa fa-check"></i><b>4.7</b> Results presented as R table</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="compare-outputs-of-fgsea-and-gsea.html"><a href="compare-outputs-of-fgsea-and-gsea.html"><i class="fa fa-check"></i><b>5</b> Compare Outputs of fGSEA and GSEA</a>
<ul>
<li class="chapter" data-level="5.1" data-path="compare-outputs-of-fgsea-and-gsea.html"><a href="compare-outputs-of-fgsea-and-gsea.html#load-in-required-libraries-and-files."><i class="fa fa-check"></i><b>5.1</b> Load in required libraries and files.</a></li>
<li class="chapter" data-level="5.2" data-path="compare-outputs-of-fgsea-and-gsea.html"><a href="compare-outputs-of-fgsea-and-gsea.html#compare-nes-values"><i class="fa fa-check"></i><b>5.2</b> Compare NES values</a></li>
<li class="chapter" data-level="5.3" data-path="compare-outputs-of-fgsea-and-gsea.html"><a href="compare-outputs-of-fgsea-and-gsea.html#compare-p-values"><i class="fa fa-check"></i><b>5.3</b> Compare p-values</a></li>
<li class="chapter" data-level="5.4" data-path="compare-outputs-of-fgsea-and-gsea.html"><a href="compare-outputs-of-fgsea-and-gsea.html#compare-corrected-p--values"><i class="fa fa-check"></i><b>5.4</b> Compare corrected p- values</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html"><i class="fa fa-check"></i><b>6</b> Create Enrichment map from R with GSEA results</a>
<ul>
<li class="chapter" data-level="6.1" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#initialize-variables-and-libraries"><i class="fa fa-check"></i><b>6.1</b> Initialize variables and libraries</a></li>
<li class="chapter" data-level="6.2" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#configurable-parameters-2"><i class="fa fa-check"></i><b>6.2</b> Configurable Parameters</a></li>
<li class="chapter" data-level="6.3" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#specify-data-files"><i class="fa fa-check"></i><b>6.3</b> Specify Data files</a></li>
<li class="chapter" data-level="6.4" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#optional-file-specification"><i class="fa fa-check"></i><b>6.4</b> Optional File specification</a></li>
<li class="chapter" data-level="6.5" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#launch-cytoscape"><i class="fa fa-check"></i><b>6.5</b> Launch Cytoscape</a></li>
<li class="chapter" data-level="6.6" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#make-sure-you-can-connect-to-cytoscape"><i class="fa fa-check"></i><b>6.6</b> Make sure you can connect to Cytoscape</a></li>
<li class="chapter" data-level="6.7" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#create-an-enrichment-map"><i class="fa fa-check"></i><b>6.7</b> Create an Enrichment map</a></li>
<li class="chapter" data-level="6.8" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#create-an-enrichment-map---run-em-command"><i class="fa fa-check"></i><b>6.8</b> Create an Enrichment map - run EM command</a></li>
<li class="chapter" data-level="6.9" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#get-a-screen-shot-of-the-initial-network."><i class="fa fa-check"></i><b>6.9</b> Get a screen shot of the initial network.</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html"><i class="fa fa-check"></i><b>7</b> Create Enrichment map from R with GSEA results</a>
<ul>
<li class="chapter" data-level="7.1" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#initialize-variables-and-libraries-1"><i class="fa fa-check"></i><b>7.1</b> Initialize variables and libraries</a></li>
<li class="chapter" data-level="7.2" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#configurable-parameters-3"><i class="fa fa-check"></i><b>7.2</b> Configurable Parameters</a></li>
<li class="chapter" data-level="7.3" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#specify-data-files-1"><i class="fa fa-check"></i><b>7.3</b> Specify Data files</a></li>
<li class="chapter" data-level="7.4" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#optional-file-specification-1"><i class="fa fa-check"></i><b>7.4</b> Optional File specification</a></li>
<li class="chapter" data-level="7.5" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#launch-cytoscape-1"><i class="fa fa-check"></i><b>7.5</b> Launch Cytoscape</a></li>
<li class="chapter" data-level="7.6" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#make-sure-you-can-connect-to-cytoscape-1"><i class="fa fa-check"></i><b>7.6</b> Make sure you can connect to Cytoscape</a></li>
<li class="chapter" data-level="7.7" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#create-an-enrichment-map-1"><i class="fa fa-check"></i><b>7.7</b> Create an Enrichment map</a></li>
<li class="chapter" data-level="7.8" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#create-an-enrichment-map---run-em-command-1"><i class="fa fa-check"></i><b>7.8</b> Create an Enrichment map - run EM command</a></li>
<li class="chapter" data-level="7.9" data-path="create-enrichment-map-from-r-with-gsea-results-1.html"><a href="create-enrichment-map-from-r-with-gsea-results-1.html#get-a-screen-shot-of-the-initial-network.-1"><i class="fa fa-check"></i><b>7.9</b> Get a screen shot of the initial network.</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
<li class="divider"></li>
<li><a href="https://baderlab.org" target="blank"><img src="./images/baderlablogo.png" width="280">Bader Lab</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Comparison of GSEA and fGSEA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="run-gsea-from-within-r" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Run GSEA from within R<a href="run-gsea-from-within-r.html#run-gsea-from-within-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This notebook is based largely on the <a href="https://baderlab.github.io/Cytoscape_workflows/EnrichmentMapPipeline/Protocol2_createEM.html">original notebook</a> published with EnrichmentMap Protocol<span class="citation">(<a href="#ref-em2019">Reimand et al. 2019</a>)</span></p>
<p>There is no package to run the original algorithm of GSEA<span class="citation">(<a href="#ref-gsea2005">Subramanian et al. 2005</a>)</span> in R. There are many packages that have been published to imitate the process but none are recognized by The GSEA team.<br />
<img src="images/gsea_r_package_message.png" alt="GSEA R package message" /></p>
<div id="load-in-required-libraries" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Load in required libraries<a href="run-gsea-from-within-r.html#load-in-required-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="run-gsea-from-within-r.html#cb1-1" tabindex="-1"></a><span class="co">#install required R and bioconductor packages</span></span>
<span id="cb1-2"><a href="run-gsea-from-within-r.html#cb1-2" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="at">expr =</span> { <span class="fu">library</span>(<span class="st">&quot;RCurl&quot;</span>)}, </span>
<span id="cb1-3"><a href="run-gsea-from-within-r.html#cb1-3" tabindex="-1"></a>         <span class="at">error =</span> <span class="cf">function</span>(e) {  </span>
<span id="cb1-4"><a href="run-gsea-from-within-r.html#cb1-4" tabindex="-1"></a>           <span class="fu">install.packages</span>(<span class="st">&quot;RCurl&quot;</span>)}, </span>
<span id="cb1-5"><a href="run-gsea-from-within-r.html#cb1-5" tabindex="-1"></a>         <span class="at">finally =</span> <span class="fu">library</span>(<span class="st">&quot;RCurl&quot;</span>))</span></code></pre></div>
</div>
<div id="configurable-parameters" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Configurable Parameters<a href="run-gsea-from-within-r.html#configurable-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to run GSEA automatically through the notebook you will need to download the gsea jar from <a href="http://software.broadinstitute.org/gsea/downloads.jsp">here</a>. Specify the exact path to the gsea jar in the parameters in order to automatically compute enrichments using GSEA.</p>
<p>If you are running this notebook using the <a href="https://hub.docker.com/r/risserlin/workshop_base_image">baderlab workshop docker image</a> then the image comes pre-installed with the gsea jar that you can use to run gsea directly in the docker. The path to the GSEA jar in the docker is - /home/rstudio/GSEA_4.3.2/gsea-cli.sh</p>
<p>In order to run GSEA automatically you need to speciry the path to the gsea jar file.
The gsea_jar needs to be the full path to the GSEA 4.3.3 directory that you downloaded from GSEA. for example /Users/johnsmith/GSEA_4.3.3/gsea-cli.sh</p>
<p>The parameters are set manually here but if you want to run the script from the command line then you can update the notebook to pull the parameters from the command line given arguments by updating each variable below to pull the values from the paramters - for example:</p>
<ul>
<li>variable &lt;- params$parameter_name</li>
</ul>
<p>For more details see - <a href="https://bookdown.org/yihui/rmarkdown/params-declare.html">defining and using parameters</a> and <a href="https://bookdown.org/yihui/rmarkdown/params-knit.html">Knitting with parameters</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="run-gsea-from-within-r.html#cb2-1" tabindex="-1"></a><span class="co">#path to GSEA jar </span></span>
<span id="cb2-2"><a href="run-gsea-from-within-r.html#cb2-2" tabindex="-1"></a><span class="co"># defined in the paramters at top of notebook</span></span>
<span id="cb2-3"><a href="run-gsea-from-within-r.html#cb2-3" tabindex="-1"></a>gsea_jar <span class="ot">&lt;-</span> params<span class="sc">$</span>gsea_jar</span></code></pre></div>
<p>Set the working directory as the directory to the directory where you downloaded all protocol files. For example /User/JohnSmith/EMProtocolFiles/data</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="run-gsea-from-within-r.html#cb3-1" tabindex="-1"></a><span class="co"># defined in the paramters at top of notebook</span></span>
<span id="cb3-2"><a href="run-gsea-from-within-r.html#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="run-gsea-from-within-r.html#cb3-3" tabindex="-1"></a><span class="co">#directory where all the data files are found.  For example -   ./data/ </span></span>
<span id="cb3-4"><a href="run-gsea-from-within-r.html#cb3-4" tabindex="-1"></a>working_dir <span class="ot">&lt;-</span> params<span class="sc">$</span>working_dir</span>
<span id="cb3-5"><a href="run-gsea-from-within-r.html#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="run-gsea-from-within-r.html#cb3-6" tabindex="-1"></a><span class="co">#directory where all the data files are found.  For example -   ./generated_data/gsea/</span></span>
<span id="cb3-7"><a href="run-gsea-from-within-r.html#cb3-7" tabindex="-1"></a>output_dir <span class="ot">&lt;-</span> params<span class="sc">$</span>output_dir</span>
<span id="cb3-8"><a href="run-gsea-from-within-r.html#cb3-8" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(output_dir)){</span>
<span id="cb3-9"><a href="run-gsea-from-within-r.html#cb3-9" tabindex="-1"></a>  <span class="fu">dir.create</span>(output_dir)</span>
<span id="cb3-10"><a href="run-gsea-from-within-r.html#cb3-10" tabindex="-1"></a>}</span>
<span id="cb3-11"><a href="run-gsea-from-within-r.html#cb3-11" tabindex="-1"></a></span>
<span id="cb3-12"><a href="run-gsea-from-within-r.html#cb3-12" tabindex="-1"></a><span class="co">#The name to give the analysis in GSEA - for example Basal_vs_Classical</span></span>
<span id="cb3-13"><a href="run-gsea-from-within-r.html#cb3-13" tabindex="-1"></a>analysis_name <span class="ot">&lt;-</span> params<span class="sc">$</span>analysis_name</span>
<span id="cb3-14"><a href="run-gsea-from-within-r.html#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="run-gsea-from-within-r.html#cb3-15" tabindex="-1"></a><span class="co">#rank file to use in GSEA analysis.  </span></span>
<span id="cb3-16"><a href="run-gsea-from-within-r.html#cb3-16" tabindex="-1"></a><span class="co">#For example - TCGA-PAAD_GDC_Subtype_Moffitt_BasalvsClassical_ranks.rnk</span></span>
<span id="cb3-17"><a href="run-gsea-from-within-r.html#cb3-17" tabindex="-1"></a>rnk_file <span class="ot">&lt;-</span> params<span class="sc">$</span>rnk_file</span>
<span id="cb3-18"><a href="run-gsea-from-within-r.html#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="run-gsea-from-within-r.html#cb3-19" tabindex="-1"></a><span class="co">#run_gsea - true/false</span></span>
<span id="cb3-20"><a href="run-gsea-from-within-r.html#cb3-20" tabindex="-1"></a><span class="co"># This parameter is for the compilation of the notebook.  </span></span>
<span id="cb3-21"><a href="run-gsea-from-within-r.html#cb3-21" tabindex="-1"></a>run_gsea <span class="ot">&lt;-</span> params<span class="sc">$</span>run_gsea</span>
<span id="cb3-22"><a href="run-gsea-from-within-r.html#cb3-22" tabindex="-1"></a></span>
<span id="cb3-23"><a href="run-gsea-from-within-r.html#cb3-23" tabindex="-1"></a><span class="co">#set the gmt file you want to use if you don&#39;t want to use the latest gmt file.</span></span>
<span id="cb3-24"><a href="run-gsea-from-within-r.html#cb3-24" tabindex="-1"></a><span class="co"># For example, if you set dest_gmt_file ==&quot;&quot; the below script will automatically</span></span>
<span id="cb3-25"><a href="run-gsea-from-within-r.html#cb3-25" tabindex="-1"></a><span class="co"># download the latest gmt file from baderlab webstie.  If it is set then it</span></span>
<span id="cb3-26"><a href="run-gsea-from-within-r.html#cb3-26" tabindex="-1"></a><span class="co"># will use the file specified.  </span></span>
<span id="cb3-27"><a href="run-gsea-from-within-r.html#cb3-27" tabindex="-1"></a>dest_gmt_file <span class="ot">=</span> params<span class="sc">$</span>gsea_directory</span></code></pre></div>
</div>
<div id="download-the-latest-pathway-definition-file" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Download the latest pathway definition file<a href="run-gsea-from-within-r.html#download-the-latest-pathway-definition-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Only Human, Mouse, Rat, and Woodchuck gene set files are currently available on the baderlab downloads site. If you are working with a species other than human (and it is either rat,mouse or woodchuck) change the gmt_url below to the correct species. Check <a href="http://download.baderlab.org/EM_Genesets/current_release/">here</a> to see all available species.</p>
<p>To create your own GMT file using Ensembl see [Create GMT file from Ensembl]</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="run-gsea-from-within-r.html#cb4-1" tabindex="-1"></a><span class="cf">if</span>(dest_gmt_file <span class="sc">==</span> <span class="st">&quot;&quot;</span>){</span>
<span id="cb4-2"><a href="run-gsea-from-within-r.html#cb4-2" tabindex="-1"></a>  gmt_url <span class="ot">=</span> <span class="st">&quot;http://download.baderlab.org/EM_Genesets/current_release/Human/symbol/&quot;</span></span>
<span id="cb4-3"><a href="run-gsea-from-within-r.html#cb4-3" tabindex="-1"></a>  </span>
<span id="cb4-4"><a href="run-gsea-from-within-r.html#cb4-4" tabindex="-1"></a>  <span class="co">#list all the files on the server</span></span>
<span id="cb4-5"><a href="run-gsea-from-within-r.html#cb4-5" tabindex="-1"></a>  filenames <span class="ot">=</span> <span class="fu">getURL</span>(gmt_url)</span>
<span id="cb4-6"><a href="run-gsea-from-within-r.html#cb4-6" tabindex="-1"></a>  tc <span class="ot">=</span> <span class="fu">textConnection</span>(filenames)</span>
<span id="cb4-7"><a href="run-gsea-from-within-r.html#cb4-7" tabindex="-1"></a>  contents <span class="ot">=</span> <span class="fu">readLines</span>(tc)</span>
<span id="cb4-8"><a href="run-gsea-from-within-r.html#cb4-8" tabindex="-1"></a>  <span class="fu">close</span>(tc)</span>
<span id="cb4-9"><a href="run-gsea-from-within-r.html#cb4-9" tabindex="-1"></a>  </span>
<span id="cb4-10"><a href="run-gsea-from-within-r.html#cb4-10" tabindex="-1"></a>  <span class="co">#get the gmt that has all the pathways and does not include terms </span></span>
<span id="cb4-11"><a href="run-gsea-from-within-r.html#cb4-11" tabindex="-1"></a>  <span class="co"># inferred from electronic annotations(IEA)</span></span>
<span id="cb4-12"><a href="run-gsea-from-within-r.html#cb4-12" tabindex="-1"></a>  <span class="co">#start with gmt file that has pathways only and GO Biological Process only.</span></span>
<span id="cb4-13"><a href="run-gsea-from-within-r.html#cb4-13" tabindex="-1"></a>  rx <span class="ot">=</span> <span class="fu">gregexpr</span>(<span class="st">&quot;(?&lt;=&lt;a href=</span><span class="sc">\&quot;</span><span class="st">)(.*.GOBP_AllPathways_noPFOCR_no_GO_iea.*.)(.gmt)(?=</span><span class="sc">\&quot;</span><span class="st">&gt;)&quot;</span>,</span>
<span id="cb4-14"><a href="run-gsea-from-within-r.html#cb4-14" tabindex="-1"></a>    contents, <span class="at">perl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-15"><a href="run-gsea-from-within-r.html#cb4-15" tabindex="-1"></a>  gmt_file <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">regmatches</span>(contents, rx))</span>
<span id="cb4-16"><a href="run-gsea-from-within-r.html#cb4-16" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="run-gsea-from-within-r.html#cb4-17" tabindex="-1"></a>  dest_gmt_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir,gmt_file )</span>
<span id="cb4-18"><a href="run-gsea-from-within-r.html#cb4-18" tabindex="-1"></a>  </span>
<span id="cb4-19"><a href="run-gsea-from-within-r.html#cb4-19" tabindex="-1"></a>  <span class="co">#check if this gmt file already exists</span></span>
<span id="cb4-20"><a href="run-gsea-from-within-r.html#cb4-20" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(dest_gmt_file)){</span>
<span id="cb4-21"><a href="run-gsea-from-within-r.html#cb4-21" tabindex="-1"></a>    <span class="fu">download.file</span>(</span>
<span id="cb4-22"><a href="run-gsea-from-within-r.html#cb4-22" tabindex="-1"></a>      <span class="fu">paste</span>(gmt_url,gmt_file,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb4-23"><a href="run-gsea-from-within-r.html#cb4-23" tabindex="-1"></a>      <span class="at">destfile=</span>dest_gmt_file</span>
<span id="cb4-24"><a href="run-gsea-from-within-r.html#cb4-24" tabindex="-1"></a>    )</span>
<span id="cb4-25"><a href="run-gsea-from-within-r.html#cb4-25" tabindex="-1"></a>  }</span>
<span id="cb4-26"><a href="run-gsea-from-within-r.html#cb4-26" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb4-27"><a href="run-gsea-from-within-r.html#cb4-27" tabindex="-1"></a>  <span class="fu">file.copy</span>(dest_gmt_file,<span class="at">to =</span> output_dir)</span>
<span id="cb4-28"><a href="run-gsea-from-within-r.html#cb4-28" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<hr />
</div>
<div id="run-gsea" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Run GSEA<a href="run-gsea-from-within-r.html#run-gsea" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(GSEA)[<a href="http://software.broadinstitute.org/gsea/index.jsp" class="uri">http://software.broadinstitute.org/gsea/index.jsp</a>] is a stand alone java program with many customizable options. It can be easily run through its integrated user interface. To make this a seemless pipeline we can run GSEA from the command line with a set of options. Any of the supplied options can be customized and there are many additional options that can be specified. For more details see (here)[<a href="http://software.broadinstitute.org/gsea/doc/GSEAUserGuideTEXT.htm#_Running_GSEA_from" class="uri">http://software.broadinstitute.org/gsea/doc/GSEAUserGuideTEXT.htm#_Running_GSEA_from</a>]</p>
<p>In the below command the following options have been specified:</p>
<ul>
<li>rnk - path to the rank file</li>
<li>gmx - path to the gene set definition (gmt) file</li>
<li>collapse - true/false indicates whether the expression/rnk file needs to be collapsed from probes to gene symbols</li>
<li>nperm - number of permutations</li>
<li>scoring_scheme -</li>
<li>rpt_label - name of the directory with output</li>
<li>rnd_seed - random seed to use</li>
<li>set_max - maximum size for individual gene sets. In GSEA interface this is set to 500 but we prefer to use a more stringent setting of 200.</li>
<li>set_min - minimum size for individual gene sets</li>
<li>zip_report - true/false to zip output directory</li>
<li>out - directory where to place the result directory.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="run-gsea-from-within-r.html#cb6-1" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb6-2"><a href="run-gsea-from-within-r.html#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="run-gsea-from-within-r.html#cb6-3" tabindex="-1"></a><span class="cf">if</span>(run_gsea){</span>
<span id="cb6-4"><a href="run-gsea-from-within-r.html#cb6-4" tabindex="-1"></a>  command <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;&quot;</span>,gsea_jar,  </span>
<span id="cb6-5"><a href="run-gsea-from-within-r.html#cb6-5" tabindex="-1"></a>                   <span class="st">&quot;GSEAPreRanked -gmx&quot;</span>, dest_gmt_file, </span>
<span id="cb6-6"><a href="run-gsea-from-within-r.html#cb6-6" tabindex="-1"></a>                   <span class="st">&quot;-rnk&quot;</span> ,<span class="fu">file.path</span>(working_dir,rnk_file), </span>
<span id="cb6-7"><a href="run-gsea-from-within-r.html#cb6-7" tabindex="-1"></a>                   <span class="st">&quot;-collapse false -nperm 1000 -scoring_scheme weighted&quot;</span>, </span>
<span id="cb6-8"><a href="run-gsea-from-within-r.html#cb6-8" tabindex="-1"></a>                   <span class="st">&quot;-rpt_label &quot;</span>,analysis_name,</span>
<span id="cb6-9"><a href="run-gsea-from-within-r.html#cb6-9" tabindex="-1"></a>                   <span class="st">&quot;  -plot_top_x 20 -rnd_seed 12345  -set_max 500&quot;</span>,  </span>
<span id="cb6-10"><a href="run-gsea-from-within-r.html#cb6-10" tabindex="-1"></a>                   <span class="st">&quot; -set_min 15 -zip_report false &quot;</span>,</span>
<span id="cb6-11"><a href="run-gsea-from-within-r.html#cb6-11" tabindex="-1"></a>                   <span class="st">&quot; -out&quot;</span> ,output_dir, </span>
<span id="cb6-12"><a href="run-gsea-from-within-r.html#cb6-12" tabindex="-1"></a>                   <span class="st">&quot; &gt; gsea_output.txt&quot;</span>,<span class="at">sep=</span><span class="st">&quot; &quot;</span>)</span>
<span id="cb6-13"><a href="run-gsea-from-within-r.html#cb6-13" tabindex="-1"></a>  <span class="fu">system</span>(command)</span>
<span id="cb6-14"><a href="run-gsea-from-within-r.html#cb6-14" tabindex="-1"></a>}</span>
<span id="cb6-15"><a href="run-gsea-from-within-r.html#cb6-15" tabindex="-1"></a></span>
<span id="cb6-16"><a href="run-gsea-from-within-r.html#cb6-16" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span></code></pre></div>
</div>
<div id="timing" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Timing<a href="run-gsea-from-within-r.html#timing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>GSEA started at 2025-04-29 15:27:58.810297</p>
<p>GSEA finished at 2025-04-29 15:34:15.140584</p>
<p>GSEA total running time -</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="run-gsea-from-within-r.html#cb7-1" tabindex="-1"></a>end_time <span class="sc">-</span> start_time</span></code></pre></div>
<pre><code>## Time difference of 6.272171 mins</code></pre>

</div>
</div>
<h3> References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-em2019" class="csl-entry">
Reimand, Jüri, Ruth Isserlin, Veronique Voisin, Mike Kucera, Christian Tannus-Lopes, Asha Rostamianfar, Lina Wadi, et al. 2019. <span>“Pathway Enrichment Analysis and Visualization of Omics Data Using g: Profiler, GSEA, Cytoscape and EnrichmentMap.”</span> <em>Nature Protocols</em> 14 (2): 482–517.
</div>
<div id="ref-gsea2005" class="csl-entry">
Subramanian, Aravind, Pablo Tamayo, Vamsi K Mootha, Sayan Mukherjee, Benjamin L Ebert, Michael A Gillette, Amanda Paulovich, et al. 2005. <span>“Gene Set Enrichment Analysis: A Knowledge-Based Approach for Interpreting Genome-Wide Expression Profiles.”</span> <em>Proceedings of the National Academy of Sciences</em> 102 (43): 15545–50.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="run-fgsea-from-within-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/BaderLab/GSEA_vs_fGSEA/edit/main/04B-Timed_Run_gsea_in_R.Rmd",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["cbw_workshop_notebooks.pdf", "https://github.com/BaderLab/GSEA_vs_fGSEA/raw/main/04B-Timed_Run_gsea_in_R.Rmd"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
