<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Run g:profiler from R | Translate gmt file from human to another species</title>
  <meta name="description" content="These are example R Notebooks to run g:profiler and GSEA and visualize results in Cytoscape with Enrichment map directly from R" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Run g:profiler from R | Translate gmt file from human to another species" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/cover.png" />
  <meta property="og:description" content="These are example R Notebooks to run g:profiler and GSEA and visualize results in Cytoscape with Enrichment map directly from R" />
  <meta name="github-repo" content="risserlin/CBW_pathways_workshop_R_notebooks" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Run g:profiler from R | Translate gmt file from human to another species" />
  
  <meta name="twitter:description" content="These are example R Notebooks to run g:profiler and GSEA and visualize results in Cytoscape with Enrichment map directly from R" />
  <meta name="twitter:image" content="/images/cover.png" />

<meta name="author" content="Ruth Isserlin" />


<meta name="date" content="2024-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="setup.html"/>
<link rel="next" href="run-gsea-from-within-r.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://bioinformatics.ca/workshops/current-workshops/"><img src="./images/bioinfologo.png" width="280"></a><a href="./">CBW Workshop R Notebooks</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Index</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> CBW Workshop example R Notebooks</a></li>
<li class="chapter" data-level="3" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>3</b> Setup</a>
<ul>
<li class="chapter" data-level="3.1" data-path="setup.html"><a href="setup.html#install-r-and-rstudio"><i class="fa fa-check"></i><b>3.1</b> Install R and RStudio</a></li>
<li class="chapter" data-level="3.2" data-path="setup.html"><a href="setup.html#docker-optional"><i class="fa fa-check"></i><b>3.2</b> Docker [Optional]</a></li>
<li class="chapter" data-level="3.3" data-path="setup.html"><a href="setup.html#install-docker"><i class="fa fa-check"></i><b>3.3</b> Install Docker</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="setup.html"><a href="setup.html#windows"><i class="fa fa-check"></i><b>3.3.1</b> Windows</a></li>
<li class="chapter" data-level="3.3.2" data-path="setup.html"><a href="setup.html#macos-linux"><i class="fa fa-check"></i><b>3.3.2</b> MacOS / Linux</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html"><i class="fa fa-check"></i><b>4</b> Run g:profiler from R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#initialize-variables-and-libraries"><i class="fa fa-check"></i><b>4.1</b> Initialize variables and libraries</a></li>
<li class="chapter" data-level="4.2" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#load-in-query-set"><i class="fa fa-check"></i><b>4.2</b> Load in Query set</a></li>
<li class="chapter" data-level="4.3" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#run-gprofiler-with-supplied-genesets"><i class="fa fa-check"></i><b>4.3</b> Run g:profiler with supplied genesets</a></li>
<li class="chapter" data-level="4.4" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#download-and-load-gprofiler-geneset-file"><i class="fa fa-check"></i><b>4.4</b> Download and load g:profiler geneset file</a></li>
<li class="chapter" data-level="4.5" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#filter-results-by-geneset-size"><i class="fa fa-check"></i><b>4.5</b> Filter results by geneset size</a></li>
<li class="chapter" data-level="4.6" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#create-an-output-file-of-the-results---generic-enrichment-map-file-from-gprofiler-gmt"><i class="fa fa-check"></i><b>4.6</b> Create an output file of the results - Generic enrichment Map file from g:profiler gmt</a></li>
<li class="chapter" data-level="4.7" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#run-gprofiler-with-your-own-genesets-example-using-baderlab-genesets"><i class="fa fa-check"></i><b>4.7</b> Run g:profiler with your own genesets (example using BaderLab genesets)</a></li>
<li class="chapter" data-level="4.8" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#download-and-load-bader-lab-geneset-file"><i class="fa fa-check"></i><b>4.8</b> Download and load Bader lab geneset file</a></li>
<li class="chapter" data-level="4.9" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#filter-bader-lab-geneset-file"><i class="fa fa-check"></i><b>4.9</b> Filter Bader lab geneset file</a></li>
<li class="chapter" data-level="4.10" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#upload-the-gmt-files-to-gprofiler"><i class="fa fa-check"></i><b>4.10</b> Upload the gmt files to gprofiler</a></li>
<li class="chapter" data-level="4.11" data-path="run-gprofiler-from-r.html"><a href="run-gprofiler-from-r.html#create-an-output-file-of-the-results---generic-enrichment-map-file-from-baderlab-gmt"><i class="fa fa-check"></i><b>4.11</b> Create an output file of the results - Generic enrichment Map file from Baderlab gmt</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html"><i class="fa fa-check"></i><b>5</b> Run GSEA from within R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#load-in-required-libraries"><i class="fa fa-check"></i><b>5.1</b> Load in required libraries</a></li>
<li class="chapter" data-level="5.2" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#configurable-parameters"><i class="fa fa-check"></i><b>5.2</b> Configurable Parameters</a></li>
<li class="chapter" data-level="5.3" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#download-the-latest-pathway-definition-file"><i class="fa fa-check"></i><b>5.3</b> Download the latest pathway definition file</a></li>
<li class="chapter" data-level="5.4" data-path="run-gsea-from-within-r.html"><a href="run-gsea-from-within-r.html#run-gsea"><i class="fa fa-check"></i><b>5.4</b> Run GSEA</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html"><i class="fa fa-check"></i><b>6</b> Create GMT file from Ensembl</a>
<ul>
<li class="chapter" data-level="6.1" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html#load-libraries"><i class="fa fa-check"></i><b>6.1</b> Load Libraries</a></li>
<li class="chapter" data-level="6.2" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html#set-up-biomart-connection"><i class="fa fa-check"></i><b>6.2</b> Set up Biomart connection</a></li>
<li class="chapter" data-level="6.3" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html#get-species-go-annotations"><i class="fa fa-check"></i><b>6.3</b> Get species GO annotations</a></li>
<li class="chapter" data-level="6.4" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html#format-results-into-gmt-file"><i class="fa fa-check"></i><b>6.4</b> Format results into GMT file</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="translate-human-gmt-file-to-another-species-using-ensembl.html"><a href="translate-human-gmt-file-to-another-species-using-ensembl.html"><i class="fa fa-check"></i><b>7</b> Translate human gmt file to another species using ensembl</a>
<ul>
<li class="chapter" data-level="7.1" data-path="translate-human-gmt-file-to-another-species-using-ensembl.html"><a href="translate-human-gmt-file-to-another-species-using-ensembl.html#load-in-required-libraries-1"><i class="fa fa-check"></i><b>7.1</b> Load in required libraries</a></li>
<li class="chapter" data-level="7.2" data-path="translate-human-gmt-file-to-another-species-using-ensembl.html"><a href="translate-human-gmt-file-to-another-species-using-ensembl.html#download-the-latest-pathway-definition-file-1"><i class="fa fa-check"></i><b>7.2</b> Download the latest pathway definition file</a></li>
<li class="chapter" data-level="7.3" data-path="translate-human-gmt-file-to-another-species-using-ensembl.html"><a href="translate-human-gmt-file-to-another-species-using-ensembl.html#set-up-biomart-connection-1"><i class="fa fa-check"></i><b>7.3</b> Set up Biomart connection</a></li>
<li class="chapter" data-level="7.4" data-path="translate-human-gmt-file-to-another-species-using-ensembl.html"><a href="translate-human-gmt-file-to-another-species-using-ensembl.html#convert-the-species-genes-from-human"><i class="fa fa-check"></i><b>7.4</b> Convert the species genes from human</a></li>
<li class="chapter" data-level="7.5" data-path="translate-human-gmt-file-to-another-species-using-ensembl.html"><a href="translate-human-gmt-file-to-another-species-using-ensembl.html#format-results-into-gmt-file-1"><i class="fa fa-check"></i><b>7.5</b> Format results into GMT file</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html"><i class="fa fa-check"></i><b>8</b> Create Enrichment map from R with g:Profiler results</a>
<ul>
<li class="chapter" data-level="8.1" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html#initialize-variables-and-libraries-1"><i class="fa fa-check"></i><b>8.1</b> Initialize variables and libraries</a></li>
<li class="chapter" data-level="8.2" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html#configurable-parameters-1"><i class="fa fa-check"></i><b>8.2</b> Configurable Parameters</a></li>
<li class="chapter" data-level="8.3" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html#specify-data-files"><i class="fa fa-check"></i><b>8.3</b> Specify Data files</a></li>
<li class="chapter" data-level="8.4" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html#launch-cytoscape"><i class="fa fa-check"></i><b>8.4</b> Launch Cytoscape</a></li>
<li class="chapter" data-level="8.5" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html#make-sure-you-can-connect-to-cytoscape"><i class="fa fa-check"></i><b>8.5</b> Make sure you can connect to Cytoscape</a></li>
<li class="chapter" data-level="8.6" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html#create-an-enrichment-map"><i class="fa fa-check"></i><b>8.6</b> Create an Enrichment map</a></li>
<li class="chapter" data-level="8.7" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html#create-an-enrichment-map---run-em-command"><i class="fa fa-check"></i><b>8.7</b> Create an Enrichment map - run EM command</a></li>
<li class="chapter" data-level="8.8" data-path="create-enrichment-map-from-r-with-gprofiler-results.html"><a href="create-enrichment-map-from-r-with-gprofiler-results.html#get-a-screen-shot-of-the-initial-network."><i class="fa fa-check"></i><b>8.8</b> Get a screen shot of the initial network.</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html"><i class="fa fa-check"></i><b>9</b> Create Enrichment map from R with GSEA results</a>
<ul>
<li class="chapter" data-level="9.1" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#initialize-variables-and-libraries-2"><i class="fa fa-check"></i><b>9.1</b> Initialize variables and libraries</a></li>
<li class="chapter" data-level="9.2" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#configurable-parameters-2"><i class="fa fa-check"></i><b>9.2</b> Configurable Parameters</a></li>
<li class="chapter" data-level="9.3" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#specify-data-files-1"><i class="fa fa-check"></i><b>9.3</b> Specify Data files</a></li>
<li class="chapter" data-level="9.4" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#optional-file-specification"><i class="fa fa-check"></i><b>9.4</b> Optional File specification</a></li>
<li class="chapter" data-level="9.5" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#launch-cytoscape-1"><i class="fa fa-check"></i><b>9.5</b> Launch Cytoscape</a></li>
<li class="chapter" data-level="9.6" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#make-sure-you-can-connect-to-cytoscape-1"><i class="fa fa-check"></i><b>9.6</b> Make sure you can connect to Cytoscape</a></li>
<li class="chapter" data-level="9.7" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#create-an-enrichment-map-1"><i class="fa fa-check"></i><b>9.7</b> Create an Enrichment map</a></li>
<li class="chapter" data-level="9.8" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#create-an-enrichment-map---run-em-command-1"><i class="fa fa-check"></i><b>9.8</b> Create an Enrichment map - run EM command</a></li>
<li class="chapter" data-level="9.9" data-path="create-enrichment-map-from-r-with-gsea-results.html"><a href="create-enrichment-map-from-r-with-gsea-results.html#get-a-screen-shot-of-the-initial-network.-1"><i class="fa fa-check"></i><b>9.9</b> Get a screen shot of the initial network.</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
<li class="divider"></li>
<li><a href="https://baderlab.org" target="blank"><img src="./images/baderlablogo.png" width="280">Bader Lab</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Translate gmt file from human to another species</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="run-gprofiler-from-r" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Run g:profiler from R<a href="run-gprofiler-from-r.html#run-gprofiler-from-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="initialize-variables-and-libraries" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Initialize variables and libraries<a href="run-gprofiler-from-r.html#initialize-variables-and-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Detailed instructions on how to run <a href="https://biit.cs.ut.ee/gprofiler/gost">g:Profiler</a> programmatically from R</p>
<p>The parameters are set manually here but if you want to run the script from the command line then you can update the notebook to pull the parameters from the command line given arguments by updating each variable below to pull the values from the paramters - for example:</p>
<ul>
<li>variable &lt;- params$parameter_name</li>
</ul>
<p>For more details see - <a href="https://bookdown.org/yihui/rmarkdown/params-declare.html">defining and using parameters</a> and <a href="https://bookdown.org/yihui/rmarkdown/params-knit.html">Knitting with parameters</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="run-gprofiler-from-r.html#cb3-1" tabindex="-1"></a><span class="co">#all parameters are pulled from the defined parameters at the top of the notebook</span></span>
<span id="cb3-2"><a href="run-gprofiler-from-r.html#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="run-gprofiler-from-r.html#cb3-3" tabindex="-1"></a><span class="co">#where to put all the generated files</span></span>
<span id="cb3-4"><a href="run-gprofiler-from-r.html#cb3-4" tabindex="-1"></a><span class="co"># for example - &quot;./generated_data/g_profiler&quot;</span></span>
<span id="cb3-5"><a href="run-gprofiler-from-r.html#cb3-5" tabindex="-1"></a>working_dir <span class="ot">&lt;-</span> params<span class="sc">$</span>working_dir</span>
<span id="cb3-6"><a href="run-gprofiler-from-r.html#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="run-gprofiler-from-r.html#cb3-7" tabindex="-1"></a><span class="co"># where to find the data files needed to run the analysis</span></span>
<span id="cb3-8"><a href="run-gprofiler-from-r.html#cb3-8" tabindex="-1"></a><span class="co"># for example = &quot;./data&quot;</span></span>
<span id="cb3-9"><a href="run-gprofiler-from-r.html#cb3-9" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span>  params<span class="sc">$</span>data_dir</span>
<span id="cb3-10"><a href="run-gprofiler-from-r.html#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="run-gprofiler-from-r.html#cb3-11" tabindex="-1"></a><span class="co"># File name containing the list of genes to be used for analysis</span></span>
<span id="cb3-12"><a href="run-gprofiler-from-r.html#cb3-12" tabindex="-1"></a><span class="co"># fro example - &quot;Supplementary_Table1_Cancer_drivers.txt&quot;</span></span>
<span id="cb3-13"><a href="run-gprofiler-from-r.html#cb3-13" tabindex="-1"></a>genelist_file <span class="ot">&lt;-</span> params<span class="sc">$</span>genelist_file</span>
<span id="cb3-14"><a href="run-gprofiler-from-r.html#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="run-gprofiler-from-r.html#cb3-15" tabindex="-1"></a><span class="co"># default max size of the genesets for example -  250.  For this example we</span></span>
<span id="cb3-16"><a href="run-gprofiler-from-r.html#cb3-16" tabindex="-1"></a><span class="co"># will be varying this parameter</span></span>
<span id="cb3-17"><a href="run-gprofiler-from-r.html#cb3-17" tabindex="-1"></a>max_gs_size <span class="ot">&lt;-</span> params<span class="sc">$</span>max_gs_size</span>
<span id="cb3-18"><a href="run-gprofiler-from-r.html#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="run-gprofiler-from-r.html#cb3-19" tabindex="-1"></a><span class="co"># default min size of the genesets for example -  3</span></span>
<span id="cb3-20"><a href="run-gprofiler-from-r.html#cb3-20" tabindex="-1"></a>min_gs_size <span class="ot">&lt;-</span> params<span class="sc">$</span>min_gs_size</span>
<span id="cb3-21"><a href="run-gprofiler-from-r.html#cb3-21" tabindex="-1"></a></span>
<span id="cb3-22"><a href="run-gprofiler-from-r.html#cb3-22" tabindex="-1"></a><span class="co">#min intersection between your genelist and the geneset - for example 3</span></span>
<span id="cb3-23"><a href="run-gprofiler-from-r.html#cb3-23" tabindex="-1"></a>min_intersection <span class="ot">&lt;-</span> params<span class="sc">$</span>min_intersection</span>
<span id="cb3-24"><a href="run-gprofiler-from-r.html#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="run-gprofiler-from-r.html#cb3-25" tabindex="-1"></a><span class="co"># organism parameter used for g:profiler.  </span></span>
<span id="cb3-26"><a href="run-gprofiler-from-r.html#cb3-26" tabindex="-1"></a><span class="co"># First letter of first word in species name followed by </span></span>
<span id="cb3-27"><a href="run-gprofiler-from-r.html#cb3-27" tabindex="-1"></a><span class="co"># the second word for example - hsapiens</span></span>
<span id="cb3-28"><a href="run-gprofiler-from-r.html#cb3-28" tabindex="-1"></a>organism <span class="ot">&lt;-</span> params<span class="sc">$</span>organism</span>
<span id="cb3-29"><a href="run-gprofiler-from-r.html#cb3-29" tabindex="-1"></a></span>
<span id="cb3-30"><a href="run-gprofiler-from-r.html#cb3-30" tabindex="-1"></a><span class="co">#set the gmt file you want to use if you don&#39;t want to use the latest gmt file.</span></span>
<span id="cb3-31"><a href="run-gprofiler-from-r.html#cb3-31" tabindex="-1"></a><span class="co"># For example, if you set dest_gmt_file ==&quot;&quot; the below script will automatically</span></span>
<span id="cb3-32"><a href="run-gprofiler-from-r.html#cb3-32" tabindex="-1"></a><span class="co"># download the latest gmt file from baderlab webstie.  If it is set then it</span></span>
<span id="cb3-33"><a href="run-gprofiler-from-r.html#cb3-33" tabindex="-1"></a><span class="co"># will use the file specified.  </span></span>
<span id="cb3-34"><a href="run-gprofiler-from-r.html#cb3-34" tabindex="-1"></a>dest_gmt_file <span class="ot">=</span> <span class="st">&quot;&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="run-gprofiler-from-r.html#cb4-1" tabindex="-1"></a><span class="co">#use library</span></span>
<span id="cb4-2"><a href="run-gprofiler-from-r.html#cb4-2" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="at">expr =</span> { <span class="fu">library</span>(<span class="st">&quot;gprofiler2&quot;</span>)}, </span>
<span id="cb4-3"><a href="run-gprofiler-from-r.html#cb4-3" tabindex="-1"></a>         <span class="at">error =</span> <span class="cf">function</span>(e) { </span>
<span id="cb4-4"><a href="run-gprofiler-from-r.html#cb4-4" tabindex="-1"></a>           <span class="fu">install.packages</span>(<span class="st">&quot;gprofiler2&quot;</span>)}, </span>
<span id="cb4-5"><a href="run-gprofiler-from-r.html#cb4-5" tabindex="-1"></a>         <span class="at">finally =</span> <span class="fu">library</span>(<span class="st">&quot;gprofiler2&quot;</span>))</span>
<span id="cb4-6"><a href="run-gprofiler-from-r.html#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="run-gprofiler-from-r.html#cb4-7" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="at">expr =</span> { <span class="fu">library</span>(<span class="st">&quot;GSA&quot;</span>)}, </span>
<span id="cb4-8"><a href="run-gprofiler-from-r.html#cb4-8" tabindex="-1"></a>         <span class="at">error =</span> <span class="cf">function</span>(e) { </span>
<span id="cb4-9"><a href="run-gprofiler-from-r.html#cb4-9" tabindex="-1"></a>           <span class="fu">install.packages</span>(<span class="st">&quot;GSA&quot;</span>)}, </span>
<span id="cb4-10"><a href="run-gprofiler-from-r.html#cb4-10" tabindex="-1"></a>         <span class="at">finally =</span> <span class="fu">library</span>(<span class="st">&quot;GSA&quot;</span>))</span></code></pre></div>
<p>Create or set a directory to store all the generatd results</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="run-gprofiler-from-r.html#cb5-1" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(params<span class="sc">$</span>working_dir)){</span>
<span id="cb5-2"><a href="run-gprofiler-from-r.html#cb5-2" tabindex="-1"></a>  <span class="fu">dir.create</span>(params<span class="sc">$</span>working_dir)</span>
<span id="cb5-3"><a href="run-gprofiler-from-r.html#cb5-3" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="load-in-query-set" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Load in Query set<a href="run-gprofiler-from-r.html#load-in-query-set" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Load in the set of genes that we will be running g:profiler with</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="run-gprofiler-from-r.html#cb6-1" tabindex="-1"></a> <span class="co">#load in the file</span></span>
<span id="cb6-2"><a href="run-gprofiler-from-r.html#cb6-2" tabindex="-1"></a>    current_genelist <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">file =</span> </span>
<span id="cb6-3"><a href="run-gprofiler-from-r.html#cb6-3" tabindex="-1"></a>                                     <span class="fu">file.path</span>(data_dir, genelist_file),</span>
<span id="cb6-4"><a href="run-gprofiler-from-r.html#cb6-4" tabindex="-1"></a>                                   <span class="at">header =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-5"><a href="run-gprofiler-from-r.html#cb6-5" tabindex="-1"></a>                                   <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">quote =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb6-6"><a href="run-gprofiler-from-r.html#cb6-6" tabindex="-1"></a>                                   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-7"><a href="run-gprofiler-from-r.html#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="run-gprofiler-from-r.html#cb6-8" tabindex="-1"></a>  query_set <span class="ot">&lt;-</span> current_genelist<span class="sc">$</span>V1</span></code></pre></div>
<p>With regards to pathway sets there are two options when using <a href="https://biit.cs.ut.ee/gprofiler/gost">g:Profiler</a> -</p>
<ul>
<li>Use the genesets that are supplied by <a href="https://biit.cs.ut.ee/gprofiler/gost">g:Profiler</a></li>
<li>Upload your own genesets.</li>
</ul>
<p>The most common reasons for supplying your own genesets is the ability to use up to date annotations or in-house annotations that might not be available in the public sphere yet. One of the greatest features of <a href="https://biit.cs.ut.ee/gprofiler/gost">g:Profiler</a> is that it is updated on a regular basis and most of the previous versions are available online ont the <a href="https://biit.cs.ut.ee/gprofiler/page/archives">gprofiler archive</a>.</p>
<p>The <a href="https://biit.cs.ut.ee/gprofiler/page/r">gprofielr2</a> -<a href="https://biit.cs.ut.ee/gprofiler/gost">g:Profiler</a> R implementation is a wrapper for the web version. You require an internet connection to get enrichment results.</p>
</div>
<div id="run-gprofiler-with-supplied-genesets" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Run g:profiler with supplied genesets<a href="run-gprofiler-from-r.html#run-gprofiler-with-supplied-genesets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For detailed descriptions of all the parameters that can be specified for the gost g:profiler function see -<a href="https://rdrr.io/cran/gprofiler2/man/gost.html">here</a></p>
<p>For this query we are specifying -</p>
<ul>
<li>query - the set of genes of interest, as loaded in from the Supplementary_Table1_Cancer_drivers.txt file.</li>
<li>significant - set to FALSE because we want g:Profiler to return all the results not just the ones that it deems significant by its perdetermined threshold.</li>
<li>ordered_query - set to TRUE because for this set of genes they are ordered in order of their significance</li>
<li>correction_method - set to fdr. by default g:Profiler uses g:Scs</li>
<li>organism - set to “hsapiens” for homo sapiens. Organism names are constructed by concatenating the first letter of the name and the family name (according to gprofiler2 documentation)</li>
<li>source - the geneset source databases to use for the analysis. We recommend using GO biological process (<a href="GO:BP" class="uri">GO:BP</a>), WikiPathways (WP) and Reactome (Reac) but there are additional sources you can add (GO molecular function or cellular component(<a href="GO:MF" class="uri">GO:MF</a>, <a href="GO:CC" class="uri">GO:CC</a>), KEGG, transcription factors (TF), microRNA targets (MIRNA), corum complexes (CORUM), Human protein atlas (HPA),Human phenotype ontology (HP) )</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="run-gprofiler-from-r.html#cb7-1" tabindex="-1"></a>gprofiler_results <span class="ot">&lt;-</span> <span class="fu">gost</span>(<span class="at">query =</span> query_set ,</span>
<span id="cb7-2"><a href="run-gprofiler-from-r.html#cb7-2" tabindex="-1"></a>                          <span class="at">significant=</span><span class="cn">FALSE</span>,</span>
<span id="cb7-3"><a href="run-gprofiler-from-r.html#cb7-3" tabindex="-1"></a>                          <span class="at">ordered_query =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-4"><a href="run-gprofiler-from-r.html#cb7-4" tabindex="-1"></a>                          <span class="at">exclude_iea=</span><span class="cn">TRUE</span>,</span>
<span id="cb7-5"><a href="run-gprofiler-from-r.html#cb7-5" tabindex="-1"></a>                          <span class="at">correction_method =</span> <span class="st">&quot;fdr&quot;</span>,</span>
<span id="cb7-6"><a href="run-gprofiler-from-r.html#cb7-6" tabindex="-1"></a>                          <span class="at">organism =</span> organism,</span>
<span id="cb7-7"><a href="run-gprofiler-from-r.html#cb7-7" tabindex="-1"></a>                          <span class="at">source =</span> <span class="fu">c</span>(<span class="st">&quot;REAC&quot;</span>,<span class="st">&quot;WP&quot;</span>,<span class="st">&quot;GO:BP&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="run-gprofiler-from-r.html#cb8-1" tabindex="-1"></a> <span class="co">#get the gprofiler results table</span></span>
<span id="cb8-2"><a href="run-gprofiler-from-r.html#cb8-2" tabindex="-1"></a>enrichment_results <span class="ot">&lt;-</span> gprofiler_results<span class="sc">$</span>result</span>
<span id="cb8-3"><a href="run-gprofiler-from-r.html#cb8-3" tabindex="-1"></a>    </span>
<span id="cb8-4"><a href="run-gprofiler-from-r.html#cb8-4" tabindex="-1"></a>enrichment_results[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##     query significant      p_value term_size query_size intersection_size
## 1 query_1        TRUE 1.266713e-31      4791        117                99
## 2 query_1        TRUE 6.230929e-31      4911        117                99
## 3 query_1        TRUE 2.945299e-30      5297        117               101
## 4 query_1        TRUE 2.945299e-30      5313        117               101
## 5 query_1        TRUE 3.692367e-28      5757        117               102
##   precision     recall    term_id source
## 1 0.8461538 0.02066374 GO:0051171  GO:BP
## 2 0.8461538 0.02015883 GO:0080090  GO:BP
## 3 0.8632479 0.01906740 GO:0060255  GO:BP
## 4 0.8632479 0.01900998 GO:0031323  GO:BP
## 5 0.8717949 0.01771756 GO:0019222  GO:BP
##                                           term_name effective_domain_size
## 1 regulation of nitrogen compound metabolic process                 16178
## 2           regulation of primary metabolic process                 16178
## 3     regulation of macromolecule metabolic process                 16178
## 4          regulation of cellular metabolic process                 16178
## 5                   regulation of metabolic process                 16178
##   source_order                            parents
## 1        13995             GO:0006807, GO:0019222
## 2        18320             GO:0019222, GO:0044238
## 3        14938             GO:0019222, GO:0043170
## 4         7372 GO:0019222, GO:0044237, GO:0050794
## 5         5789             GO:0008152, GO:0050789</code></pre>
</div>
<div id="download-and-load-gprofiler-geneset-file" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Download and load g:profiler geneset file<a href="run-gprofiler-from-r.html#download-and-load-gprofiler-geneset-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to create a proper Generic enrichment results file we will need a copy of the gmt file used by g:Profiler. (also to create an Enrichment map).</p>
<p>Download the gmt file used for this analysis from g:profiler</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="run-gprofiler-from-r.html#cb10-1" tabindex="-1"></a><span class="co">#the link to the gmt file is static no matter what version</span></span>
<span id="cb10-2"><a href="run-gprofiler-from-r.html#cb10-2" tabindex="-1"></a>gprofiler_gmt_url <span class="ot">&lt;-</span> </span>
<span id="cb10-3"><a href="run-gprofiler-from-r.html#cb10-3" tabindex="-1"></a>  <span class="st">&quot;https://biit.cs.ut.ee/gprofiler/static/gprofiler_full_hsapiens.name.gmt&quot;</span></span>
<span id="cb10-4"><a href="run-gprofiler-from-r.html#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="run-gprofiler-from-r.html#cb10-5" tabindex="-1"></a><span class="co">#get version info gprofiler as the gmt file is always associated with </span></span>
<span id="cb10-6"><a href="run-gprofiler-from-r.html#cb10-6" tabindex="-1"></a><span class="co"># a specific version of g:profiler</span></span>
<span id="cb10-7"><a href="run-gprofiler-from-r.html#cb10-7" tabindex="-1"></a>gprofiler_version <span class="ot">&lt;-</span> <span class="fu">get_version_info</span>(<span class="at">organism=</span>organism)</span>
<span id="cb10-8"><a href="run-gprofiler-from-r.html#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="run-gprofiler-from-r.html#cb10-9" tabindex="-1"></a>gprofiler_gmt_filename <span class="ot">&lt;-</span> <span class="fu">file.path</span>(working_dir,</span>
<span id="cb10-10"><a href="run-gprofiler-from-r.html#cb10-10" tabindex="-1"></a>                                  <span class="fu">paste</span>(<span class="st">&quot;gprofiler_full&quot;</span>, organism,</span>
<span id="cb10-11"><a href="run-gprofiler-from-r.html#cb10-11" tabindex="-1"></a>                                    gprofiler_version<span class="sc">$</span>gprofiler_version,<span class="at">sep=</span><span class="st">&quot;_&quot;</span>,</span>
<span id="cb10-12"><a href="run-gprofiler-from-r.html#cb10-12" tabindex="-1"></a>                                    <span class="st">&quot;.name.gmt&quot;</span>))</span>
<span id="cb10-13"><a href="run-gprofiler-from-r.html#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="run-gprofiler-from-r.html#cb10-14" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(gprofiler_gmt_filename)){</span>
<span id="cb10-15"><a href="run-gprofiler-from-r.html#cb10-15" tabindex="-1"></a>  <span class="fu">download.file</span>(<span class="at">url =</span> gprofiler_gmt_url, </span>
<span id="cb10-16"><a href="run-gprofiler-from-r.html#cb10-16" tabindex="-1"></a>              <span class="at">destfile =</span> gprofiler_gmt_filename)</span>
<span id="cb10-17"><a href="run-gprofiler-from-r.html#cb10-17" tabindex="-1"></a>}</span></code></pre></div>
<p>To create a proper Generic enrichmentMap results file we need to include the list of genes that are associated with each geneset. To do that we need to know what genes are associated with each set and filter them by our query set. Load in the geneset definitions from the gmt file we just downloaded from g:profiler site.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="run-gprofiler-from-r.html#cb11-1" tabindex="-1"></a><span class="co">#load in the g:profiler geneset file</span></span>
<span id="cb11-2"><a href="run-gprofiler-from-r.html#cb11-2" tabindex="-1"></a>capt_output <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(genesets_gprofiler <span class="ot">&lt;-</span> <span class="fu">GSA.read.gmt</span>(</span>
<span id="cb11-3"><a href="run-gprofiler-from-r.html#cb11-3" tabindex="-1"></a>                                      <span class="at">filename =</span> gprofiler_gmt_filename))</span>
<span id="cb11-4"><a href="run-gprofiler-from-r.html#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="run-gprofiler-from-r.html#cb11-5" tabindex="-1"></a><span class="fu">names</span>(genesets_gprofiler<span class="sc">$</span>genesets) <span class="ot">&lt;-</span> genesets_gprofiler<span class="sc">$</span>geneset.names</span></code></pre></div>
<p>For the next module the name of the gmt file is - gprofiler_full_hsapiens.name.gmt but it is important to preserve the database version so in the future when we revisit these results for publication or results verfication we have the exact version used. Instead of creating a copy of the file (which can be pretty large) create a symbolic link to the file with the generic name.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="run-gprofiler-from-r.html#cb12-1" tabindex="-1"></a><span class="co">#file.exists does not work for a symbolic link on my computer for some reason</span></span>
<span id="cb12-2"><a href="run-gprofiler-from-r.html#cb12-2" tabindex="-1"></a><span class="co"># list the files in the directory and check if the symbolic link is there</span></span>
<span id="cb12-3"><a href="run-gprofiler-from-r.html#cb12-3" tabindex="-1"></a><span class="co">#if(file.exists(file.path(working_dir, &quot;gprofiler_full_hsapiens.name.gmt&quot;))){</span></span>
<span id="cb12-4"><a href="run-gprofiler-from-r.html#cb12-4" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">grep</span>(<span class="at">x =</span> <span class="fu">list.files</span>(<span class="fu">file.path</span>(working_dir)), </span>
<span id="cb12-5"><a href="run-gprofiler-from-r.html#cb12-5" tabindex="-1"></a>              <span class="at">pattern =</span> <span class="st">&quot;gprofiler_full_hsapiens.name.gmt&quot;</span>,</span>
<span id="cb12-6"><a href="run-gprofiler-from-r.html#cb12-6" tabindex="-1"></a>              <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span> )){</span>
<span id="cb12-7"><a href="run-gprofiler-from-r.html#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="run-gprofiler-from-r.html#cb12-8" tabindex="-1"></a>  <span class="fu">file.remove</span>(<span class="fu">file.path</span>(working_dir, <span class="st">&quot;gprofiler_full_hsapiens.name.gmt&quot;</span>))</span>
<span id="cb12-9"><a href="run-gprofiler-from-r.html#cb12-9" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="run-gprofiler-from-r.html#cb14-1" tabindex="-1"></a><span class="fu">file.symlink</span>( gprofiler_gmt_filename,<span class="fu">file.path</span>(working_dir, </span>
<span id="cb14-2"><a href="run-gprofiler-from-r.html#cb14-2" tabindex="-1"></a>                                   <span class="st">&quot;gprofiler_full_hsapiens.name.gmt&quot;</span>))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="run-gprofiler-from-r.html#cb16-1" tabindex="-1"></a><span class="co"># Given:</span></span>
<span id="cb16-2"><a href="run-gprofiler-from-r.html#cb16-2" tabindex="-1"></a><span class="co"># query_genes - genes used for enrichment analysis (or as query)</span></span>
<span id="cb16-3"><a href="run-gprofiler-from-r.html#cb16-3" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb16-4"><a href="run-gprofiler-from-r.html#cb16-4" tabindex="-1"></a><span class="co"># returns - the genes that overlap with the query set and part of the given</span></span>
<span id="cb16-5"><a href="run-gprofiler-from-r.html#cb16-5" tabindex="-1"></a><span class="co">#           genesets</span></span>
<span id="cb16-6"><a href="run-gprofiler-from-r.html#cb16-6" tabindex="-1"></a>getGenesetGenes <span class="ot">&lt;-</span> <span class="cf">function</span>(query_genes, subset_genesets){</span>
<span id="cb16-7"><a href="run-gprofiler-from-r.html#cb16-7" tabindex="-1"></a>  genes <span class="ot">&lt;-</span> <span class="fu">lapply</span>(subset_genesets,<span class="at">FUN=</span><span class="cf">function</span>(x){<span class="fu">intersect</span>(x,query_genes)})</span>
<span id="cb16-8"><a href="run-gprofiler-from-r.html#cb16-8" tabindex="-1"></a>  </span>
<span id="cb16-9"><a href="run-gprofiler-from-r.html#cb16-9" tabindex="-1"></a>  <span class="co"># For each of the genes collapse to the comma separate text</span></span>
<span id="cb16-10"><a href="run-gprofiler-from-r.html#cb16-10" tabindex="-1"></a>  genes_collapsed <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(genes,<span class="at">FUN=</span><span class="cf">function</span>(x){</span>
<span id="cb16-11"><a href="run-gprofiler-from-r.html#cb16-11" tabindex="-1"></a>                                                <span class="fu">paste</span>(x,<span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>)}))</span>
<span id="cb16-12"><a href="run-gprofiler-from-r.html#cb16-12" tabindex="-1"></a>  </span>
<span id="cb16-13"><a href="run-gprofiler-from-r.html#cb16-13" tabindex="-1"></a>  genes_collapsed_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">term_id =</span> <span class="fu">names</span>(genes), </span>
<span id="cb16-14"><a href="run-gprofiler-from-r.html#cb16-14" tabindex="-1"></a>                            <span class="at">genes =</span> genes_collapsed,<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-15"><a href="run-gprofiler-from-r.html#cb16-15" tabindex="-1"></a>  </span>
<span id="cb16-16"><a href="run-gprofiler-from-r.html#cb16-16" tabindex="-1"></a>  <span class="fu">return</span>(genes_collapsed_df)</span>
<span id="cb16-17"><a href="run-gprofiler-from-r.html#cb16-17" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="filter-results-by-geneset-size" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Filter results by geneset size<a href="run-gprofiler-from-r.html#filter-results-by-geneset-size" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Filter the table to include just the columns that are required for the generic enrichment map file results <a href="https://enrichmentmap.readthedocs.io/en/latest/FileFormats.html#generic-results-files">GEM</a>. Restrict the results to just the ones that have at least min_gs_size and less than max_gs_size terms and min_intersection size include only the term_id, term_name, p_value (and p_value again because the p_value is actually the corrected p-value. The output file does not contain the nominal p_value. For down stream analysis though it is expected to have both a p-value and a q-value so just duplicate the q-value as both p-value and q-value)</p>
<p>Vary the thresholds for max_gs_size just as we did in Module 2 lab -</p>
<ul>
<li><p>min_gs_size = 3</p></li>
<li><p>max_gs_size = 10000</p></li>
<li><p>max_gs_size = 1000</p></li>
<li><p>max_gs_size = 250</p></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="run-gprofiler-from-r.html#cb17-1" tabindex="-1"></a><span class="co"># filer by params defined above</span></span>
<span id="cb17-2"><a href="run-gprofiler-from-r.html#cb17-2" tabindex="-1"></a><span class="co"># by default we have set the max and min gs size to 250 and 3, respectively.</span></span>
<span id="cb17-3"><a href="run-gprofiler-from-r.html#cb17-3" tabindex="-1"></a>enrichment_results_mxgssize_250_min_3 <span class="ot">&lt;-</span> </span>
<span id="cb17-4"><a href="run-gprofiler-from-r.html#cb17-4" tabindex="-1"></a>                        <span class="fu">subset</span>(enrichment_results,term_size <span class="sc">&gt;=</span> min_gs_size <span class="sc">&amp;</span> </span>
<span id="cb17-5"><a href="run-gprofiler-from-r.html#cb17-5" tabindex="-1"></a>                                   term_size <span class="sc">&lt;=</span> max_gs_size <span class="sc">&amp;</span> </span>
<span id="cb17-6"><a href="run-gprofiler-from-r.html#cb17-6" tabindex="-1"></a>                                   intersection_size <span class="sc">&gt;=</span> min_intersection , </span>
<span id="cb17-7"><a href="run-gprofiler-from-r.html#cb17-7" tabindex="-1"></a>                                 <span class="at">select =</span> <span class="fu">c</span>(term_id,term_name,p_value,p_value ))</span>
<span id="cb17-8"><a href="run-gprofiler-from-r.html#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="run-gprofiler-from-r.html#cb17-9" tabindex="-1"></a>enrichment_results_mxgssize_1000_min_3 <span class="ot">&lt;-</span> </span>
<span id="cb17-10"><a href="run-gprofiler-from-r.html#cb17-10" tabindex="-1"></a>                        <span class="fu">subset</span>(enrichment_results,term_size <span class="sc">&gt;=</span> min_gs_size <span class="sc">&amp;</span> </span>
<span id="cb17-11"><a href="run-gprofiler-from-r.html#cb17-11" tabindex="-1"></a>                                   term_size <span class="sc">&lt;=</span> <span class="dv">1000</span> <span class="sc">&amp;</span> </span>
<span id="cb17-12"><a href="run-gprofiler-from-r.html#cb17-12" tabindex="-1"></a>                                   intersection_size <span class="sc">&gt;=</span> min_intersection , </span>
<span id="cb17-13"><a href="run-gprofiler-from-r.html#cb17-13" tabindex="-1"></a>                                 <span class="at">select =</span> <span class="fu">c</span>(term_id,term_name,p_value,p_value ))</span>
<span id="cb17-14"><a href="run-gprofiler-from-r.html#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="run-gprofiler-from-r.html#cb17-15" tabindex="-1"></a>enrichment_results_mxgssize_10000_min_3 <span class="ot">&lt;-</span> </span>
<span id="cb17-16"><a href="run-gprofiler-from-r.html#cb17-16" tabindex="-1"></a>                        <span class="fu">subset</span>(enrichment_results,term_size <span class="sc">&gt;=</span> min_gs_size <span class="sc">&amp;</span> </span>
<span id="cb17-17"><a href="run-gprofiler-from-r.html#cb17-17" tabindex="-1"></a>                                   term_size <span class="sc">&lt;=</span> <span class="dv">10000</span> <span class="sc">&amp;</span> </span>
<span id="cb17-18"><a href="run-gprofiler-from-r.html#cb17-18" tabindex="-1"></a>                                   intersection_size <span class="sc">&gt;=</span> min_intersection , </span>
<span id="cb17-19"><a href="run-gprofiler-from-r.html#cb17-19" tabindex="-1"></a>                                 <span class="at">select =</span> <span class="fu">c</span>(term_id,term_name,p_value,p_value ))</span></code></pre></div>
</div>
<div id="create-an-output-file-of-the-results---generic-enrichment-map-file-from-gprofiler-gmt" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Create an output file of the results - Generic enrichment Map file from g:profiler gmt<a href="run-gprofiler-from-r.html#create-an-output-file-of-the-results---generic-enrichment-map-file-from-gprofiler-gmt" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The file requires -</p>
<ul>
<li>name</li>
<li>description</li>
<li>p-value</li>
<li>q-value</li>
<li>phenotyp</li>
<li>list of genes (overlap of query set and original geneset)</li>
</ul>
<p>The list of genes needs to be calculated using the gmt file and original query set. For each geneset found in the result find the overlap between the set of genes that are a part of the geneset and the query set.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="run-gprofiler-from-r.html#cb18-1" tabindex="-1"></a><span class="co"># Given:</span></span>
<span id="cb18-2"><a href="run-gprofiler-from-r.html#cb18-2" tabindex="-1"></a><span class="co"># gprofiler_results - results form g_profiler R function (filtered by desired)</span></span>
<span id="cb18-3"><a href="run-gprofiler-from-r.html#cb18-3" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb18-4"><a href="run-gprofiler-from-r.html#cb18-4" tabindex="-1"></a><span class="co"># gs - genes associated with each geneset, loaded in from a gmt file. </span></span>
<span id="cb18-5"><a href="run-gprofiler-from-r.html#cb18-5" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb18-6"><a href="run-gprofiler-from-r.html#cb18-6" tabindex="-1"></a><span class="co"># returns - the properly formatted GEM file results</span></span>
<span id="cb18-7"><a href="run-gprofiler-from-r.html#cb18-7" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb18-8"><a href="run-gprofiler-from-r.html#cb18-8" tabindex="-1"></a>createGEMformat <span class="ot">&lt;-</span> <span class="cf">function</span>(results, gs, query_genes){</span>
<span id="cb18-9"><a href="run-gprofiler-from-r.html#cb18-9" tabindex="-1"></a></span>
<span id="cb18-10"><a href="run-gprofiler-from-r.html#cb18-10" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(results) <span class="sc">&gt;</span><span class="dv">0</span>){    </span>
<span id="cb18-11"><a href="run-gprofiler-from-r.html#cb18-11" tabindex="-1"></a></span>
<span id="cb18-12"><a href="run-gprofiler-from-r.html#cb18-12" tabindex="-1"></a>           <span class="co">#add phenotype to the results</span></span>
<span id="cb18-13"><a href="run-gprofiler-from-r.html#cb18-13" tabindex="-1"></a>          formatted_results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(results,<span class="dv">1</span>)</span>
<span id="cb18-14"><a href="run-gprofiler-from-r.html#cb18-14" tabindex="-1"></a>          </span>
<span id="cb18-15"><a href="run-gprofiler-from-r.html#cb18-15" tabindex="-1"></a>          <span class="co"># Add the genes to the genesets</span></span>
<span id="cb18-16"><a href="run-gprofiler-from-r.html#cb18-16" tabindex="-1"></a>          subset_genesets <span class="ot">&lt;-</span> gs<span class="sc">$</span>genesets[</span>
<span id="cb18-17"><a href="run-gprofiler-from-r.html#cb18-17" tabindex="-1"></a>            <span class="fu">which</span>(gs<span class="sc">$</span>geneset.names </span>
<span id="cb18-18"><a href="run-gprofiler-from-r.html#cb18-18" tabindex="-1"></a>                  <span class="sc">%in%</span> results<span class="sc">$</span>term_id)]</span>
<span id="cb18-19"><a href="run-gprofiler-from-r.html#cb18-19" tabindex="-1"></a>          </span>
<span id="cb18-20"><a href="run-gprofiler-from-r.html#cb18-20" tabindex="-1"></a>          genes <span class="ot">&lt;-</span> <span class="fu">getGenesetGenes</span>(query_genes, subset_genesets)</span>
<span id="cb18-21"><a href="run-gprofiler-from-r.html#cb18-21" tabindex="-1"></a>          </span>
<span id="cb18-22"><a href="run-gprofiler-from-r.html#cb18-22" tabindex="-1"></a>          formatted_results <span class="ot">&lt;-</span> <span class="fu">merge</span>(formatted_results,genes,<span class="at">by.x=</span><span class="dv">1</span>, <span class="at">by.y=</span><span class="dv">1</span>)</span>
<span id="cb18-23"><a href="run-gprofiler-from-r.html#cb18-23" tabindex="-1"></a>          </span>
<span id="cb18-24"><a href="run-gprofiler-from-r.html#cb18-24" tabindex="-1"></a>          <span class="fu">colnames</span>(formatted_results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;description&quot;</span>,<span class="st">&quot;p-value&quot;</span>,</span>
<span id="cb18-25"><a href="run-gprofiler-from-r.html#cb18-25" tabindex="-1"></a>                                           <span class="st">&quot;q-value&quot;</span>,<span class="st">&quot;phenotype&quot;</span>,<span class="st">&quot;genes&quot;</span>)</span>
<span id="cb18-26"><a href="run-gprofiler-from-r.html#cb18-26" tabindex="-1"></a>          </span>
<span id="cb18-27"><a href="run-gprofiler-from-r.html#cb18-27" tabindex="-1"></a>  }</span>
<span id="cb18-28"><a href="run-gprofiler-from-r.html#cb18-28" tabindex="-1"></a>  <span class="fu">return</span>(formatted_results)</span>
<span id="cb18-29"><a href="run-gprofiler-from-r.html#cb18-29" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="run-gprofiler-from-r.html#cb19-1" tabindex="-1"></a>enrichment_results_mxgssize_10000_min_3_GEMfile <span class="ot">&lt;-</span> <span class="fu">createGEMformat</span>(</span>
<span id="cb19-2"><a href="run-gprofiler-from-r.html#cb19-2" tabindex="-1"></a>  enrichment_results_mxgssize_10000_min_3, genesets_gprofiler, query_set)</span>
<span id="cb19-3"><a href="run-gprofiler-from-r.html#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="run-gprofiler-from-r.html#cb19-4" tabindex="-1"></a>enrichment_results_mxgssize_1000_min_3_GEMfile <span class="ot">&lt;-</span> <span class="fu">createGEMformat</span>(</span>
<span id="cb19-5"><a href="run-gprofiler-from-r.html#cb19-5" tabindex="-1"></a>  enrichment_results_mxgssize_1000_min_3, genesets_gprofiler, query_set)</span>
<span id="cb19-6"><a href="run-gprofiler-from-r.html#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="run-gprofiler-from-r.html#cb19-7" tabindex="-1"></a>enrichment_results_mxgssize_250_min_3_GEMfile <span class="ot">&lt;-</span> <span class="fu">createGEMformat</span>(</span>
<span id="cb19-8"><a href="run-gprofiler-from-r.html#cb19-8" tabindex="-1"></a>  enrichment_results_mxgssize_250_min_3, genesets_gprofiler, query_set)</span></code></pre></div>
<p>Output each of the above filtered files</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="run-gprofiler-from-r.html#cb20-1" tabindex="-1"></a><span class="co">#output the enrichment map file</span></span>
<span id="cb20-2"><a href="run-gprofiler-from-r.html#cb20-2" tabindex="-1"></a><span class="fu">write.table</span>(enrichment_results_mxgssize_10000_min_3_GEMfile, </span>
<span id="cb20-3"><a href="run-gprofiler-from-r.html#cb20-3" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">file.path</span>(working_dir, </span>
<span id="cb20-4"><a href="run-gprofiler-from-r.html#cb20-4" tabindex="-1"></a>                <span class="st">&quot;gProfiler_hsapiens_lab2_results_GEM_termmin3_max10000.gem.txt&quot;</span>),</span>
<span id="cb20-5"><a href="run-gprofiler-from-r.html#cb20-5" tabindex="-1"></a>            <span class="at">row.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb20-6"><a href="run-gprofiler-from-r.html#cb20-6" tabindex="-1"></a>            <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,</span>
<span id="cb20-7"><a href="run-gprofiler-from-r.html#cb20-7" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-8"><a href="run-gprofiler-from-r.html#cb20-8" tabindex="-1"></a></span>
<span id="cb20-9"><a href="run-gprofiler-from-r.html#cb20-9" tabindex="-1"></a><span class="co">#output the enrichment map file</span></span>
<span id="cb20-10"><a href="run-gprofiler-from-r.html#cb20-10" tabindex="-1"></a><span class="fu">write.table</span>(enrichment_results_mxgssize_1000_min_3_GEMfile, </span>
<span id="cb20-11"><a href="run-gprofiler-from-r.html#cb20-11" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">file.path</span>(working_dir, </span>
<span id="cb20-12"><a href="run-gprofiler-from-r.html#cb20-12" tabindex="-1"></a>                <span class="st">&quot;gProfiler_hsapiens_lab2_results_GEM_termmin3_max1000.gem.txt&quot;</span>),</span>
<span id="cb20-13"><a href="run-gprofiler-from-r.html#cb20-13" tabindex="-1"></a>            <span class="at">row.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb20-14"><a href="run-gprofiler-from-r.html#cb20-14" tabindex="-1"></a>            <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,</span>
<span id="cb20-15"><a href="run-gprofiler-from-r.html#cb20-15" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-16"><a href="run-gprofiler-from-r.html#cb20-16" tabindex="-1"></a></span>
<span id="cb20-17"><a href="run-gprofiler-from-r.html#cb20-17" tabindex="-1"></a><span class="co">#output the enrichment map file</span></span>
<span id="cb20-18"><a href="run-gprofiler-from-r.html#cb20-18" tabindex="-1"></a><span class="fu">write.table</span>(enrichment_results_mxgssize_250_min_3_GEMfile, </span>
<span id="cb20-19"><a href="run-gprofiler-from-r.html#cb20-19" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">file.path</span>(working_dir, </span>
<span id="cb20-20"><a href="run-gprofiler-from-r.html#cb20-20" tabindex="-1"></a>                <span class="st">&quot;gProfiler_hsapiens_lab2_results_GEM_termmin3_max250.gem.txt&quot;</span>),</span>
<span id="cb20-21"><a href="run-gprofiler-from-r.html#cb20-21" tabindex="-1"></a>            <span class="at">row.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb20-22"><a href="run-gprofiler-from-r.html#cb20-22" tabindex="-1"></a>            <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,</span>
<span id="cb20-23"><a href="run-gprofiler-from-r.html#cb20-23" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="run-gprofiler-with-your-own-genesets-example-using-baderlab-genesets" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Run g:profiler with your own genesets (example using BaderLab genesets)<a href="run-gprofiler-from-r.html#run-gprofiler-with-your-own-genesets-example-using-baderlab-genesets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="download-and-load-bader-lab-geneset-file" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Download and load Bader lab geneset file<a href="run-gprofiler-from-r.html#download-and-load-bader-lab-geneset-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Download the latest <a href="https://download.baderlab.org/EM_Genesets/current_release/Human/">Bader lab genesets</a></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="run-gprofiler-from-r.html#cb21-1" tabindex="-1"></a><span class="cf">if</span>(dest_gmt_file <span class="sc">==</span> <span class="st">&quot;&quot;</span>){</span>
<span id="cb21-2"><a href="run-gprofiler-from-r.html#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="run-gprofiler-from-r.html#cb21-3" tabindex="-1"></a>  gmt_url <span class="ot">=</span> <span class="st">&quot;http://download.baderlab.org/EM_Genesets/current_release/Human/symbol/&quot;</span></span>
<span id="cb21-4"><a href="run-gprofiler-from-r.html#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="run-gprofiler-from-r.html#cb21-5" tabindex="-1"></a>  <span class="co">#list all the files on the server</span></span>
<span id="cb21-6"><a href="run-gprofiler-from-r.html#cb21-6" tabindex="-1"></a>  filenames <span class="ot">=</span> RCurl<span class="sc">::</span><span class="fu">getURL</span>(gmt_url)</span>
<span id="cb21-7"><a href="run-gprofiler-from-r.html#cb21-7" tabindex="-1"></a>  tc <span class="ot">=</span> <span class="fu">textConnection</span>(filenames)</span>
<span id="cb21-8"><a href="run-gprofiler-from-r.html#cb21-8" tabindex="-1"></a>  contents <span class="ot">=</span> <span class="fu">readLines</span>(tc)</span>
<span id="cb21-9"><a href="run-gprofiler-from-r.html#cb21-9" tabindex="-1"></a>  <span class="fu">close</span>(tc)</span>
<span id="cb21-10"><a href="run-gprofiler-from-r.html#cb21-10" tabindex="-1"></a>  </span>
<span id="cb21-11"><a href="run-gprofiler-from-r.html#cb21-11" tabindex="-1"></a>  <span class="co">#get the gmt that has all the pathways and does not include </span></span>
<span id="cb21-12"><a href="run-gprofiler-from-r.html#cb21-12" tabindex="-1"></a>  <span class="co"># terms inferred from electronic annotations(IEA)</span></span>
<span id="cb21-13"><a href="run-gprofiler-from-r.html#cb21-13" tabindex="-1"></a>  <span class="co">#start with gmt file that has pathways only</span></span>
<span id="cb21-14"><a href="run-gprofiler-from-r.html#cb21-14" tabindex="-1"></a>  rx <span class="ot">=</span> <span class="fu">gregexpr</span>(<span class="st">&quot;(?&lt;=&lt;a href=</span><span class="sc">\&quot;</span><span class="st">)(.*.GOBP_AllPathways_noPFOCR_no_GO_iea.*.)(.gmt)(?=</span><span class="sc">\&quot;</span><span class="st">&gt;)&quot;</span>,</span>
<span id="cb21-15"><a href="run-gprofiler-from-r.html#cb21-15" tabindex="-1"></a>    contents, <span class="at">perl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-16"><a href="run-gprofiler-from-r.html#cb21-16" tabindex="-1"></a>  gmt_file <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">regmatches</span>(contents, rx))</span>
<span id="cb21-17"><a href="run-gprofiler-from-r.html#cb21-17" tabindex="-1"></a>  </span>
<span id="cb21-18"><a href="run-gprofiler-from-r.html#cb21-18" tabindex="-1"></a>  dest_gmt_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(working_dir,gmt_file)</span>
<span id="cb21-19"><a href="run-gprofiler-from-r.html#cb21-19" tabindex="-1"></a>  </span>
<span id="cb21-20"><a href="run-gprofiler-from-r.html#cb21-20" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(dest_gmt_file)){</span>
<span id="cb21-21"><a href="run-gprofiler-from-r.html#cb21-21" tabindex="-1"></a>    <span class="fu">download.file</span>(</span>
<span id="cb21-22"><a href="run-gprofiler-from-r.html#cb21-22" tabindex="-1"></a>      <span class="fu">paste</span>(gmt_url,gmt_file,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb21-23"><a href="run-gprofiler-from-r.html#cb21-23" tabindex="-1"></a>      <span class="at">destfile=</span>dest_gmt_file</span>
<span id="cb21-24"><a href="run-gprofiler-from-r.html#cb21-24" tabindex="-1"></a>    )</span>
<span id="cb21-25"><a href="run-gprofiler-from-r.html#cb21-25" tabindex="-1"></a>  }</span>
<span id="cb21-26"><a href="run-gprofiler-from-r.html#cb21-26" tabindex="-1"></a>}</span></code></pre></div>
<p>In order to use our results down stream in the Enrichment map we need to generate results files that we can pass to Enrichment Map.</p>
<p>Load in the GMT file</p>
</div>
<div id="filter-bader-lab-geneset-file" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Filter Bader lab geneset file<a href="run-gprofiler-from-r.html#filter-bader-lab-geneset-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The g:Profiler interface only allows for filtering genesets by size only after the analysis is complete. After the analysis is complete means the filtering is happening after Multiple hypothesis testing. Filtering prior to the analysis will generate more robust results because we exclude the uninformative large genesets prior to testing changing the sets that multiple hypothesis filtering will get rid of.</p>
<p>Create multiple gmt files with different filtering thresholds - remove
* genesets greater than 250 genes
* geneset greater than 1000 genes
* geneset greater than 10000 genes</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="run-gprofiler-from-r.html#cb22-1" tabindex="-1"></a><span class="co"># Filter geneset GSA object by specified gs size threshold </span></span>
<span id="cb22-2"><a href="run-gprofiler-from-r.html#cb22-2" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-3"><a href="run-gprofiler-from-r.html#cb22-3" tabindex="-1"></a><span class="co"># Given - </span></span>
<span id="cb22-4"><a href="run-gprofiler-from-r.html#cb22-4" tabindex="-1"></a><span class="co"># genesets - in GSA object</span></span>
<span id="cb22-5"><a href="run-gprofiler-from-r.html#cb22-5" tabindex="-1"></a><span class="co"># gs_sizes - list of all the sizes of the genesets found in the genesets</span></span>
<span id="cb22-6"><a href="run-gprofiler-from-r.html#cb22-6" tabindex="-1"></a><span class="co"># filter_threshold - value to filter the geneset by.  </span></span>
<span id="cb22-7"><a href="run-gprofiler-from-r.html#cb22-7" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb22-8"><a href="run-gprofiler-from-r.html#cb22-8" tabindex="-1"></a><span class="co"># returns - filtered genesets in GSA object</span></span>
<span id="cb22-9"><a href="run-gprofiler-from-r.html#cb22-9" tabindex="-1"></a>filter_genesets <span class="ot">&lt;-</span> <span class="cf">function</span>(genesets, gs_sizes, filter_threshold) {</span>
<span id="cb22-10"><a href="run-gprofiler-from-r.html#cb22-10" tabindex="-1"></a>  </span>
<span id="cb22-11"><a href="run-gprofiler-from-r.html#cb22-11" tabindex="-1"></a>  filtered_genesets <span class="ot">&lt;-</span> genesets</span>
<span id="cb22-12"><a href="run-gprofiler-from-r.html#cb22-12" tabindex="-1"></a>  </span>
<span id="cb22-13"><a href="run-gprofiler-from-r.html#cb22-13" tabindex="-1"></a>  filtered_genesets<span class="sc">$</span>genesets <span class="ot">&lt;-</span> genesets<span class="sc">$</span>genesets[</span>
<span id="cb22-14"><a href="run-gprofiler-from-r.html#cb22-14" tabindex="-1"></a>                      <span class="fu">which</span>(gs_sizes<span class="sc">&lt;</span>filter_threshold)]</span>
<span id="cb22-15"><a href="run-gprofiler-from-r.html#cb22-15" tabindex="-1"></a>  filtered_genesets<span class="sc">$</span>geneset.names <span class="ot">&lt;-</span> genesets<span class="sc">$</span>geneset.names[</span>
<span id="cb22-16"><a href="run-gprofiler-from-r.html#cb22-16" tabindex="-1"></a>                      <span class="fu">which</span>(gs_sizes<span class="sc">&lt;</span>filter_threshold)]</span>
<span id="cb22-17"><a href="run-gprofiler-from-r.html#cb22-17" tabindex="-1"></a>  filtered_genesets<span class="sc">$</span>geneset.descriptions <span class="ot">&lt;-</span> genesets<span class="sc">$</span>geneset.descriptions[</span>
<span id="cb22-18"><a href="run-gprofiler-from-r.html#cb22-18" tabindex="-1"></a>                      <span class="fu">which</span>(gs_sizes<span class="sc">&lt;</span>filter_threshold)]</span>
<span id="cb22-19"><a href="run-gprofiler-from-r.html#cb22-19" tabindex="-1"></a></span>
<span id="cb22-20"><a href="run-gprofiler-from-r.html#cb22-20" tabindex="-1"></a>  <span class="fu">return</span>(filtered_genesets)</span>
<span id="cb22-21"><a href="run-gprofiler-from-r.html#cb22-21" tabindex="-1"></a>}</span>
<span id="cb22-22"><a href="run-gprofiler-from-r.html#cb22-22" tabindex="-1"></a></span>
<span id="cb22-23"><a href="run-gprofiler-from-r.html#cb22-23" tabindex="-1"></a><span class="co"># You can not simply write a list of lists to a file in R.  In order</span></span>
<span id="cb22-24"><a href="run-gprofiler-from-r.html#cb22-24" tabindex="-1"></a><span class="co"># to output the new geneset file you need to convert it ot a data.frame</span></span>
<span id="cb22-25"><a href="run-gprofiler-from-r.html#cb22-25" tabindex="-1"></a><span class="co"># To do this convert the list of genes to a tab delmiated list in one column</span></span>
<span id="cb22-26"><a href="run-gprofiler-from-r.html#cb22-26" tabindex="-1"></a><span class="co"># of the dataframe.</span></span>
<span id="cb22-27"><a href="run-gprofiler-from-r.html#cb22-27" tabindex="-1"></a><span class="co"># format to write out to a file. </span></span>
<span id="cb22-28"><a href="run-gprofiler-from-r.html#cb22-28" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-29"><a href="run-gprofiler-from-r.html#cb22-29" tabindex="-1"></a><span class="co"># Given - </span></span>
<span id="cb22-30"><a href="run-gprofiler-from-r.html#cb22-30" tabindex="-1"></a><span class="co"># genesets - in GSA object</span></span>
<span id="cb22-31"><a href="run-gprofiler-from-r.html#cb22-31" tabindex="-1"></a> </span>
<span id="cb22-32"><a href="run-gprofiler-from-r.html#cb22-32" tabindex="-1"></a><span class="co"># returns - formatted genesets as data frame</span></span>
<span id="cb22-33"><a href="run-gprofiler-from-r.html#cb22-33" tabindex="-1"></a>  </span>
<span id="cb22-34"><a href="run-gprofiler-from-r.html#cb22-34" tabindex="-1"></a>format_genesets <span class="ot">&lt;-</span> <span class="cf">function</span>(genesets) {</span>
<span id="cb22-35"><a href="run-gprofiler-from-r.html#cb22-35" tabindex="-1"></a>    </span>
<span id="cb22-36"><a href="run-gprofiler-from-r.html#cb22-36" tabindex="-1"></a>  collapsed_genesets <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span>genesets<span class="sc">$</span>geneset.names, </span>
<span id="cb22-37"><a href="run-gprofiler-from-r.html#cb22-37" tabindex="-1"></a>                            <span class="at">description=</span> genesets<span class="sc">$</span>geneset.description)</span>
<span id="cb22-38"><a href="run-gprofiler-from-r.html#cb22-38" tabindex="-1"></a>  collapsed_genesets<span class="sc">$</span>genes <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(genesets<span class="sc">$</span>genesets,</span>
<span id="cb22-39"><a href="run-gprofiler-from-r.html#cb22-39" tabindex="-1"></a>                                             <span class="at">FUN=</span><span class="cf">function</span>(x){</span>
<span id="cb22-40"><a href="run-gprofiler-from-r.html#cb22-40" tabindex="-1"></a>                                              <span class="fu">paste</span>(x,<span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb22-41"><a href="run-gprofiler-from-r.html#cb22-41" tabindex="-1"></a>                                            }))</span>
<span id="cb22-42"><a href="run-gprofiler-from-r.html#cb22-42" tabindex="-1"></a>  </span>
<span id="cb22-43"><a href="run-gprofiler-from-r.html#cb22-43" tabindex="-1"></a>  <span class="fu">return</span>(collapsed_genesets)</span>
<span id="cb22-44"><a href="run-gprofiler-from-r.html#cb22-44" tabindex="-1"></a>}</span></code></pre></div>
<p>The format of the GMT file is described <a href="here">https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#GMT:<em>Gene_Matrix_Transposed_file_format</em>.28.2A.gmt.29</a> and consists of rows with the following</p>
<ul>
<li>Name</li>
<li>Description</li>
<li>tab delimited list of genes a part of this geneset</li>
</ul>
<p>Write out the gmt file with genenames</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="run-gprofiler-from-r.html#cb23-1" tabindex="-1"></a><span class="co">#get the geneset sizes</span></span>
<span id="cb23-2"><a href="run-gprofiler-from-r.html#cb23-2" tabindex="-1"></a>gs_sizes_baderlab_sets <span class="ot">&lt;-</span> <span class="fu">lapply</span>(genesets_baderlab_genesets<span class="sc">$</span>genesets,</span>
<span id="cb23-3"><a href="run-gprofiler-from-r.html#cb23-3" tabindex="-1"></a>                                 <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb23-4"><a href="run-gprofiler-from-r.html#cb23-4" tabindex="-1"></a>                                               <span class="fu">length</span>(x)</span>
<span id="cb23-5"><a href="run-gprofiler-from-r.html#cb23-5" tabindex="-1"></a>                                                  })</span>
<span id="cb23-6"><a href="run-gprofiler-from-r.html#cb23-6" tabindex="-1"></a></span>
<span id="cb23-7"><a href="run-gprofiler-from-r.html#cb23-7" tabindex="-1"></a><span class="co"># max 10,000</span></span>
<span id="cb23-8"><a href="run-gprofiler-from-r.html#cb23-8" tabindex="-1"></a>genesets_baderlab_genesets_max10000 <span class="ot">&lt;-</span> <span class="fu">filter_genesets</span>(genesets_baderlab_genesets,</span>
<span id="cb23-9"><a href="run-gprofiler-from-r.html#cb23-9" tabindex="-1"></a>                                                gs_sizes_baderlab_sets, </span>
<span id="cb23-10"><a href="run-gprofiler-from-r.html#cb23-10" tabindex="-1"></a>                                                <span class="dv">10000</span>)</span>
<span id="cb23-11"><a href="run-gprofiler-from-r.html#cb23-11" tabindex="-1"></a></span>
<span id="cb23-12"><a href="run-gprofiler-from-r.html#cb23-12" tabindex="-1"></a>genesets_baderlab_genesets_max10000_filename <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x =</span>dest_gmt_file, </span>
<span id="cb23-13"><a href="run-gprofiler-from-r.html#cb23-13" tabindex="-1"></a>                                                  <span class="at">pattern =</span> <span class="st">&quot;symbol&quot;</span> ,</span>
<span id="cb23-14"><a href="run-gprofiler-from-r.html#cb23-14" tabindex="-1"></a>                                                  <span class="at">replacement =</span> <span class="st">&quot;symbol_max10000&quot;</span></span>
<span id="cb23-15"><a href="run-gprofiler-from-r.html#cb23-15" tabindex="-1"></a>                                                     )</span>
<span id="cb23-16"><a href="run-gprofiler-from-r.html#cb23-16" tabindex="-1"></a></span>
<span id="cb23-17"><a href="run-gprofiler-from-r.html#cb23-17" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(genesets_baderlab_genesets_max10000_filename)){</span>
<span id="cb23-18"><a href="run-gprofiler-from-r.html#cb23-18" tabindex="-1"></a></span>
<span id="cb23-19"><a href="run-gprofiler-from-r.html#cb23-19" tabindex="-1"></a>  <span class="fu">write.table</span>(<span class="at">x =</span> <span class="fu">format_genesets</span>(genesets_baderlab_genesets_max10000),</span>
<span id="cb23-20"><a href="run-gprofiler-from-r.html#cb23-20" tabindex="-1"></a>            <span class="at">file =</span> genesets_baderlab_genesets_max10000_filename,</span>
<span id="cb23-21"><a href="run-gprofiler-from-r.html#cb23-21" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-22"><a href="run-gprofiler-from-r.html#cb23-22" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-23"><a href="run-gprofiler-from-r.html#cb23-23" tabindex="-1"></a>}</span>
<span id="cb23-24"><a href="run-gprofiler-from-r.html#cb23-24" tabindex="-1"></a></span>
<span id="cb23-25"><a href="run-gprofiler-from-r.html#cb23-25" tabindex="-1"></a><span class="co">#max gs size of 1,000</span></span>
<span id="cb23-26"><a href="run-gprofiler-from-r.html#cb23-26" tabindex="-1"></a>genesets_baderlab_genesets_max1000 <span class="ot">&lt;-</span> <span class="fu">filter_genesets</span>(genesets_baderlab_genesets,</span>
<span id="cb23-27"><a href="run-gprofiler-from-r.html#cb23-27" tabindex="-1"></a>                                                      gs_sizes_baderlab_sets, </span>
<span id="cb23-28"><a href="run-gprofiler-from-r.html#cb23-28" tabindex="-1"></a>                                                      <span class="dv">1000</span>)</span>
<span id="cb23-29"><a href="run-gprofiler-from-r.html#cb23-29" tabindex="-1"></a>genesets_baderlab_genesets_max1000_filename <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x =</span>dest_gmt_file, </span>
<span id="cb23-30"><a href="run-gprofiler-from-r.html#cb23-30" tabindex="-1"></a>                                                <span class="at">pattern =</span> <span class="st">&quot;symbol&quot;</span> ,</span>
<span id="cb23-31"><a href="run-gprofiler-from-r.html#cb23-31" tabindex="-1"></a>                                                <span class="at">replacement =</span> <span class="st">&quot;symbol_max1000&quot;</span></span>
<span id="cb23-32"><a href="run-gprofiler-from-r.html#cb23-32" tabindex="-1"></a>                                                     )</span>
<span id="cb23-33"><a href="run-gprofiler-from-r.html#cb23-33" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(genesets_baderlab_genesets_max1000_filename)){</span>
<span id="cb23-34"><a href="run-gprofiler-from-r.html#cb23-34" tabindex="-1"></a></span>
<span id="cb23-35"><a href="run-gprofiler-from-r.html#cb23-35" tabindex="-1"></a>  <span class="fu">write.table</span>(<span class="at">x =</span> <span class="fu">format_genesets</span>(genesets_baderlab_genesets_max1000),</span>
<span id="cb23-36"><a href="run-gprofiler-from-r.html#cb23-36" tabindex="-1"></a>            <span class="at">file =</span> genesets_baderlab_genesets_max1000_filename,</span>
<span id="cb23-37"><a href="run-gprofiler-from-r.html#cb23-37" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-38"><a href="run-gprofiler-from-r.html#cb23-38" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-39"><a href="run-gprofiler-from-r.html#cb23-39" tabindex="-1"></a>}</span>
<span id="cb23-40"><a href="run-gprofiler-from-r.html#cb23-40" tabindex="-1"></a></span>
<span id="cb23-41"><a href="run-gprofiler-from-r.html#cb23-41" tabindex="-1"></a><span class="co">#max gs size of 250</span></span>
<span id="cb23-42"><a href="run-gprofiler-from-r.html#cb23-42" tabindex="-1"></a>genesets_baderlab_genesets_max250 <span class="ot">&lt;-</span> <span class="fu">filter_genesets</span>(genesets_baderlab_genesets,</span>
<span id="cb23-43"><a href="run-gprofiler-from-r.html#cb23-43" tabindex="-1"></a>                                                      gs_sizes_baderlab_sets, </span>
<span id="cb23-44"><a href="run-gprofiler-from-r.html#cb23-44" tabindex="-1"></a>                                                      <span class="dv">250</span>)</span>
<span id="cb23-45"><a href="run-gprofiler-from-r.html#cb23-45" tabindex="-1"></a></span>
<span id="cb23-46"><a href="run-gprofiler-from-r.html#cb23-46" tabindex="-1"></a></span>
<span id="cb23-47"><a href="run-gprofiler-from-r.html#cb23-47" tabindex="-1"></a>genesets_baderlab_genesets_max250_filename <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x =</span>dest_gmt_file, </span>
<span id="cb23-48"><a href="run-gprofiler-from-r.html#cb23-48" tabindex="-1"></a>                                                  <span class="at">pattern =</span> <span class="st">&quot;symbol&quot;</span> ,</span>
<span id="cb23-49"><a href="run-gprofiler-from-r.html#cb23-49" tabindex="-1"></a>                                                  <span class="at">replacement =</span> <span class="st">&quot;symbol_max250&quot;</span></span>
<span id="cb23-50"><a href="run-gprofiler-from-r.html#cb23-50" tabindex="-1"></a>                                                     )</span>
<span id="cb23-51"><a href="run-gprofiler-from-r.html#cb23-51" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(genesets_baderlab_genesets_max250_filename)){</span>
<span id="cb23-52"><a href="run-gprofiler-from-r.html#cb23-52" tabindex="-1"></a>  <span class="fu">write.table</span>(<span class="at">x =</span> <span class="fu">format_genesets</span>(genesets_baderlab_genesets_max250),</span>
<span id="cb23-53"><a href="run-gprofiler-from-r.html#cb23-53" tabindex="-1"></a>            <span class="at">file =</span> genesets_baderlab_genesets_max250_filename,</span>
<span id="cb23-54"><a href="run-gprofiler-from-r.html#cb23-54" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-55"><a href="run-gprofiler-from-r.html#cb23-55" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-56"><a href="run-gprofiler-from-r.html#cb23-56" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="upload-the-gmt-files-to-gprofiler" class="section level2 hasAnchor" number="4.10">
<h2><span class="header-section-number">4.10</span> Upload the gmt files to gprofiler<a href="run-gprofiler-from-r.html#upload-the-gmt-files-to-gprofiler" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to use your own genesets with g:Profiler you need to upload the the file to their server first. The function will return an ID that you need to specify in the organism parameter of the g:Profiler gost function call.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="run-gprofiler-from-r.html#cb24-1" tabindex="-1"></a>custom_gmt_max250 <span class="ot">&lt;-</span> <span class="fu">upload_GMT_file</span>(</span>
<span id="cb24-2"><a href="run-gprofiler-from-r.html#cb24-2" tabindex="-1"></a>                        <span class="at">gmtfile=</span>genesets_baderlab_genesets_max250_filename)</span></code></pre></div>
<pre><code>## Your custom annotations ID is gp__U4sx_h9hm_EtM.
## You can use this ID as an &#39;organism&#39; name in all the related enrichment tests against this custom source.</code></pre>
<pre><code>## Just use: gost(my_genes, organism = &#39;gp__U4sx_h9hm_EtM&#39;)</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="run-gprofiler-from-r.html#cb27-1" tabindex="-1"></a>custom_gmt_max1000 <span class="ot">&lt;-</span> <span class="fu">upload_GMT_file</span>(</span>
<span id="cb27-2"><a href="run-gprofiler-from-r.html#cb27-2" tabindex="-1"></a>                        <span class="at">gmtfile=</span>genesets_baderlab_genesets_max1000_filename)</span></code></pre></div>
<pre><code>## Your custom annotations ID is gp__kEYN_qEm9_mG4.
## You can use this ID as an &#39;organism&#39; name in all the related enrichment tests against this custom source.</code></pre>
<pre><code>## Just use: gost(my_genes, organism = &#39;gp__kEYN_qEm9_mG4&#39;)</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="run-gprofiler-from-r.html#cb30-1" tabindex="-1"></a>custom_gmt_max10000 <span class="ot">&lt;-</span> <span class="fu">upload_GMT_file</span>(</span>
<span id="cb30-2"><a href="run-gprofiler-from-r.html#cb30-2" tabindex="-1"></a>                        <span class="at">gmtfile=</span>genesets_baderlab_genesets_max10000_filename)</span></code></pre></div>
<pre><code>## Your custom annotations ID is gp__DNWX_dEd1_yYo.
## You can use this ID as an &#39;organism&#39; name in all the related enrichment tests against this custom source.</code></pre>
<pre><code>## Just use: gost(my_genes, organism = &#39;gp__DNWX_dEd1_yYo&#39;)</code></pre>
<p>For this query we are specifying -</p>
<ul>
<li>query - the set of genes of interest, as loaded in from the Supplementary_Table1_Cancer_drivers.txt file.</li>
<li>significant - set to FALSE because we want g:Profiler to return all the results not just the ones that it deems significant by its perdetermined threshold.</li>
<li>ordered_query - set to FALSE (but you can try setting it to true as well because for this set of genes they are ordered in order of their significance)</li>
<li>correction_method - set to fdr. by default g:Profiler uses g:Scs</li>
<li>organism - set to the custom_gmt ID ( for this run it is - gp__U4sx_h9hm_EtM) that we received when we uploaded our genetset file.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="run-gprofiler-from-r.html#cb33-1" tabindex="-1"></a>gprofiler_results_custom_max250 <span class="ot">&lt;-</span> <span class="fu">gost</span>(<span class="at">query =</span> query_set ,</span>
<span id="cb33-2"><a href="run-gprofiler-from-r.html#cb33-2" tabindex="-1"></a>                                     <span class="at">significant=</span><span class="cn">FALSE</span>,</span>
<span id="cb33-3"><a href="run-gprofiler-from-r.html#cb33-3" tabindex="-1"></a>                                 <span class="at">ordered_query =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-4"><a href="run-gprofiler-from-r.html#cb33-4" tabindex="-1"></a>                                  <span class="at">exclude_iea=</span><span class="cn">TRUE</span>,</span>
<span id="cb33-5"><a href="run-gprofiler-from-r.html#cb33-5" tabindex="-1"></a>                                     <span class="at">correction_method =</span> <span class="st">&quot;fdr&quot;</span>,</span>
<span id="cb33-6"><a href="run-gprofiler-from-r.html#cb33-6" tabindex="-1"></a>                                 <span class="at">organism =</span> custom_gmt_max250</span>
<span id="cb33-7"><a href="run-gprofiler-from-r.html#cb33-7" tabindex="-1"></a>                                     )</span></code></pre></div>
<pre><code>## Detected custom GMT source request</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="run-gprofiler-from-r.html#cb35-1" tabindex="-1"></a>gprofiler_results_custom_max1000 <span class="ot">&lt;-</span> <span class="fu">gost</span>(<span class="at">query =</span> query_set ,</span>
<span id="cb35-2"><a href="run-gprofiler-from-r.html#cb35-2" tabindex="-1"></a>                                     <span class="at">significant=</span><span class="cn">FALSE</span>,</span>
<span id="cb35-3"><a href="run-gprofiler-from-r.html#cb35-3" tabindex="-1"></a>                                      <span class="at">ordered_query =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-4"><a href="run-gprofiler-from-r.html#cb35-4" tabindex="-1"></a>                                      <span class="at">exclude_iea=</span><span class="cn">TRUE</span>,</span>
<span id="cb35-5"><a href="run-gprofiler-from-r.html#cb35-5" tabindex="-1"></a>                                     <span class="at">correction_method =</span> <span class="st">&quot;fdr&quot;</span>,</span>
<span id="cb35-6"><a href="run-gprofiler-from-r.html#cb35-6" tabindex="-1"></a>                                 <span class="at">organism =</span> custom_gmt_max1000</span>
<span id="cb35-7"><a href="run-gprofiler-from-r.html#cb35-7" tabindex="-1"></a>                                     )</span></code></pre></div>
<pre><code>## Detected custom GMT source request</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="run-gprofiler-from-r.html#cb37-1" tabindex="-1"></a>gprofiler_results_custom_max10000 <span class="ot">&lt;-</span> <span class="fu">gost</span>(<span class="at">query =</span> query_set ,</span>
<span id="cb37-2"><a href="run-gprofiler-from-r.html#cb37-2" tabindex="-1"></a>                                     <span class="at">significant=</span><span class="cn">FALSE</span>,</span>
<span id="cb37-3"><a href="run-gprofiler-from-r.html#cb37-3" tabindex="-1"></a>                                      <span class="at">ordered_query =</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-4"><a href="run-gprofiler-from-r.html#cb37-4" tabindex="-1"></a>                                      <span class="at">exclude_iea=</span><span class="cn">TRUE</span>,</span>
<span id="cb37-5"><a href="run-gprofiler-from-r.html#cb37-5" tabindex="-1"></a>                                     <span class="at">correction_method =</span> <span class="st">&quot;fdr&quot;</span>,</span>
<span id="cb37-6"><a href="run-gprofiler-from-r.html#cb37-6" tabindex="-1"></a>                                 <span class="at">organism =</span> custom_gmt_max10000</span>
<span id="cb37-7"><a href="run-gprofiler-from-r.html#cb37-7" tabindex="-1"></a>                                     )</span></code></pre></div>
<pre><code>## Detected custom GMT source request</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="run-gprofiler-from-r.html#cb39-1" tabindex="-1"></a> <span class="co">#get the gprofiler results table</span></span>
<span id="cb39-2"><a href="run-gprofiler-from-r.html#cb39-2" tabindex="-1"></a>enrichment_results_customgmt_max250 <span class="ot">&lt;-</span> gprofiler_results_custom_max250<span class="sc">$</span>result</span>
<span id="cb39-3"><a href="run-gprofiler-from-r.html#cb39-3" tabindex="-1"></a>enrichment_results_customgmt_max1000 <span class="ot">&lt;-</span> gprofiler_results_custom_max1000<span class="sc">$</span>result</span>
<span id="cb39-4"><a href="run-gprofiler-from-r.html#cb39-4" tabindex="-1"></a>enrichment_results_customgmt_max10000 <span class="ot">&lt;-</span> gprofiler_results_custom_max10000<span class="sc">$</span>result</span>
<span id="cb39-5"><a href="run-gprofiler-from-r.html#cb39-5" tabindex="-1"></a></span>
<span id="cb39-6"><a href="run-gprofiler-from-r.html#cb39-6" tabindex="-1"></a>    </span>
<span id="cb39-7"><a href="run-gprofiler-from-r.html#cb39-7" tabindex="-1"></a>enrichment_results_customgmt_max250[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##     query significant      p_value term_size query_size intersection_size
## 1 query_1        TRUE 2.274768e-19        69        108                17
## 2 query_1        TRUE 1.758667e-18        64        108                16
## 3 query_1        TRUE 1.639494e-14        54        108                13
## 4 query_1        TRUE 5.029242e-14        98        108                15
## 5 query_1        TRUE 1.653203e-13       160        108                17
##   precision    recall
## 1 0.1574074 0.2463768
## 2 0.1481481 0.2500000
## 3 0.1203704 0.2407407
## 4 0.1388889 0.1530612
## 5 0.1574074 0.1062500
##                                                                                   term_id
## 1               GLIOBLASTOMA SIGNALING PATHWAYS%WIKIPATHWAYS_20240510%WP2261%HOMO SAPIENS
## 2         HEAD AND NECK SQUAMOUS CELL CARCINOMA%WIKIPATHWAYS_20240510%WP4674%HOMO SAPIENS
## 3 PATHWAYS AFFECTED IN ADENOID CYSTIC CARCINOMA%WIKIPATHWAYS_20240510%WP3651%HOMO SAPIENS
## 4                                     CELL CYCLE%WIKIPATHWAYS_20240510%WP179%HOMO SAPIENS
## 5                          REGULATION OF CELL CYCLE G1/S PHASE TRANSITION%GOBP%GO:1902806
##                                                                source
## 1 Human_GOBP_AllPathways_noPFOCR_no_GO_iea_June_01_2024_symbol_max250
## 2 Human_GOBP_AllPathways_noPFOCR_no_GO_iea_June_01_2024_symbol_max250
## 3 Human_GOBP_AllPathways_noPFOCR_no_GO_iea_June_01_2024_symbol_max250
## 4 Human_GOBP_AllPathways_noPFOCR_no_GO_iea_June_01_2024_symbol_max250
## 5 Human_GOBP_AllPathways_noPFOCR_no_GO_iea_June_01_2024_symbol_max250
##                                        term_name effective_domain_size
## 1                Glioblastoma signaling pathways                 17067
## 2          Head and neck squamous cell carcinoma                 17067
## 3  Pathways affected in adenoid cystic carcinoma                 17067
## 4                                     Cell cycle                 17067
## 5 regulation of cell cycle G1/S phase transition                 17067
##   source_order parents
## 1         5048    NULL
## 2         5575    NULL
## 3         5198    NULL
## 4         5170    NULL
## 5        18856    NULL</code></pre>
<p>Filter the table to include just the columns that are required for the generic enrichment map file results <a href="https://enrichmentmap.readthedocs.io/en/latest/FileFormats.html#generic-results-files">GEM</a>. Restrict the results to just the ones that have at least min_gs_size and less than max_gs_size terms and min_intersection size include only the term_id, term_name, p_value (and p_value again because the p_value is actually the corrected p-value. The output file does not contain the nominal p_value. For down stream analysis though it is expected to have both a p-value and a q-value so just duplicate the q-value as both p-value and q-value)</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="run-gprofiler-from-r.html#cb41-1" tabindex="-1"></a><span class="co"># filer by params defined above</span></span>
<span id="cb41-2"><a href="run-gprofiler-from-r.html#cb41-2" tabindex="-1"></a>enrichment_results_customgmt_max250 <span class="ot">&lt;-</span> <span class="fu">subset</span>(enrichment_results_customgmt_max250,</span>
<span id="cb41-3"><a href="run-gprofiler-from-r.html#cb41-3" tabindex="-1"></a>                                       term_size <span class="sc">&gt;=</span> min_gs_size <span class="sc">&amp;</span> </span>
<span id="cb41-4"><a href="run-gprofiler-from-r.html#cb41-4" tabindex="-1"></a>                                   term_size <span class="sc">&lt;=</span> max_gs_size <span class="sc">&amp;</span> </span>
<span id="cb41-5"><a href="run-gprofiler-from-r.html#cb41-5" tabindex="-1"></a>                                   intersection_size <span class="sc">&gt;=</span> min_intersection , </span>
<span id="cb41-6"><a href="run-gprofiler-from-r.html#cb41-6" tabindex="-1"></a>                                 <span class="at">select =</span> <span class="fu">c</span>(term_id,term_name,p_value,p_value ))</span>
<span id="cb41-7"><a href="run-gprofiler-from-r.html#cb41-7" tabindex="-1"></a></span>
<span id="cb41-8"><a href="run-gprofiler-from-r.html#cb41-8" tabindex="-1"></a>enrichment_results_customgmt_max1000 <span class="ot">&lt;-</span> <span class="fu">subset</span>(enrichment_results_customgmt_max1000,</span>
<span id="cb41-9"><a href="run-gprofiler-from-r.html#cb41-9" tabindex="-1"></a>                                       term_size <span class="sc">&gt;=</span> min_gs_size <span class="sc">&amp;</span> </span>
<span id="cb41-10"><a href="run-gprofiler-from-r.html#cb41-10" tabindex="-1"></a>                                   term_size <span class="sc">&lt;=</span> max_gs_size <span class="sc">&amp;</span> </span>
<span id="cb41-11"><a href="run-gprofiler-from-r.html#cb41-11" tabindex="-1"></a>                                   intersection_size <span class="sc">&gt;=</span> min_intersection , </span>
<span id="cb41-12"><a href="run-gprofiler-from-r.html#cb41-12" tabindex="-1"></a>                                 <span class="at">select =</span> <span class="fu">c</span>(term_id,term_name,p_value,p_value ))</span>
<span id="cb41-13"><a href="run-gprofiler-from-r.html#cb41-13" tabindex="-1"></a></span>
<span id="cb41-14"><a href="run-gprofiler-from-r.html#cb41-14" tabindex="-1"></a>enrichment_results_customgmt_max10000 <span class="ot">&lt;-</span> <span class="fu">subset</span>(enrichment_results_customgmt_max10000,</span>
<span id="cb41-15"><a href="run-gprofiler-from-r.html#cb41-15" tabindex="-1"></a>                                       term_size <span class="sc">&gt;=</span> min_gs_size <span class="sc">&amp;</span> </span>
<span id="cb41-16"><a href="run-gprofiler-from-r.html#cb41-16" tabindex="-1"></a>                                   term_size <span class="sc">&lt;=</span> max_gs_size <span class="sc">&amp;</span> </span>
<span id="cb41-17"><a href="run-gprofiler-from-r.html#cb41-17" tabindex="-1"></a>                                   intersection_size <span class="sc">&gt;=</span> min_intersection , </span>
<span id="cb41-18"><a href="run-gprofiler-from-r.html#cb41-18" tabindex="-1"></a>                                 <span class="at">select =</span> <span class="fu">c</span>(term_id,term_name,p_value,p_value ))</span></code></pre></div>
</div>
<div id="create-an-output-file-of-the-results---generic-enrichment-map-file-from-baderlab-gmt" class="section level2 hasAnchor" number="4.11">
<h2><span class="header-section-number">4.11</span> Create an output file of the results - Generic enrichment Map file from Baderlab gmt<a href="run-gprofiler-from-r.html#create-an-output-file-of-the-results---generic-enrichment-map-file-from-baderlab-gmt" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Use the same function defined above but instead of passing the genesets from the g_profiler gmt file pass the geneset defitnions we loaded in from the Baderlab gmt file.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="run-gprofiler-from-r.html#cb42-1" tabindex="-1"></a>enrichment_results_customgmt_GEM_max250 <span class="ot">&lt;-</span> <span class="fu">createGEMformat</span>(</span>
<span id="cb42-2"><a href="run-gprofiler-from-r.html#cb42-2" tabindex="-1"></a>                                    enrichment_results_customgmt_max250, </span>
<span id="cb42-3"><a href="run-gprofiler-from-r.html#cb42-3" tabindex="-1"></a>                                    genesets_baderlab_genesets_max250, </span>
<span id="cb42-4"><a href="run-gprofiler-from-r.html#cb42-4" tabindex="-1"></a>                                    query_set)</span>
<span id="cb42-5"><a href="run-gprofiler-from-r.html#cb42-5" tabindex="-1"></a></span>
<span id="cb42-6"><a href="run-gprofiler-from-r.html#cb42-6" tabindex="-1"></a><span class="co">#output the enrichment map file</span></span>
<span id="cb42-7"><a href="run-gprofiler-from-r.html#cb42-7" tabindex="-1"></a><span class="fu">write.table</span>(enrichment_results_customgmt_GEM_max250, </span>
<span id="cb42-8"><a href="run-gprofiler-from-r.html#cb42-8" tabindex="-1"></a>                  <span class="at">file =</span> <span class="fu">file.path</span>(</span>
<span id="cb42-9"><a href="run-gprofiler-from-r.html#cb42-9" tabindex="-1"></a>                    working_dir, <span class="st">&quot;gProfiler_hsapiens_Baderlab_max250.gem.txt&quot;</span>),</span>
<span id="cb42-10"><a href="run-gprofiler-from-r.html#cb42-10" tabindex="-1"></a>                  <span class="at">row.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb42-11"><a href="run-gprofiler-from-r.html#cb42-11" tabindex="-1"></a>                  <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,</span>
<span id="cb42-12"><a href="run-gprofiler-from-r.html#cb42-12" tabindex="-1"></a>                  <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-13"><a href="run-gprofiler-from-r.html#cb42-13" tabindex="-1"></a>       </span>
<span id="cb42-14"><a href="run-gprofiler-from-r.html#cb42-14" tabindex="-1"></a>enrichment_results_customgmt_GEM_max1000 <span class="ot">&lt;-</span> <span class="fu">createGEMformat</span>(</span>
<span id="cb42-15"><a href="run-gprofiler-from-r.html#cb42-15" tabindex="-1"></a>                                  enrichment_results_customgmt_max1000,</span>
<span id="cb42-16"><a href="run-gprofiler-from-r.html#cb42-16" tabindex="-1"></a>                                  genesets_baderlab_genesets_max1000, </span>
<span id="cb42-17"><a href="run-gprofiler-from-r.html#cb42-17" tabindex="-1"></a>                                  query_set)</span>
<span id="cb42-18"><a href="run-gprofiler-from-r.html#cb42-18" tabindex="-1"></a></span>
<span id="cb42-19"><a href="run-gprofiler-from-r.html#cb42-19" tabindex="-1"></a><span class="co">#output the enrichment map file</span></span>
<span id="cb42-20"><a href="run-gprofiler-from-r.html#cb42-20" tabindex="-1"></a><span class="fu">write.table</span>(enrichment_results_customgmt_GEM_max1000, </span>
<span id="cb42-21"><a href="run-gprofiler-from-r.html#cb42-21" tabindex="-1"></a>                  <span class="at">file =</span> <span class="fu">file.path</span>(</span>
<span id="cb42-22"><a href="run-gprofiler-from-r.html#cb42-22" tabindex="-1"></a>                    working_dir, <span class="st">&quot;gProfiler_hsapiens_Baderlab_max1000.gem.txt&quot;</span>),</span>
<span id="cb42-23"><a href="run-gprofiler-from-r.html#cb42-23" tabindex="-1"></a>                  <span class="at">row.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb42-24"><a href="run-gprofiler-from-r.html#cb42-24" tabindex="-1"></a>                  <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,</span>
<span id="cb42-25"><a href="run-gprofiler-from-r.html#cb42-25" tabindex="-1"></a>                  <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-26"><a href="run-gprofiler-from-r.html#cb42-26" tabindex="-1"></a></span>
<span id="cb42-27"><a href="run-gprofiler-from-r.html#cb42-27" tabindex="-1"></a>enrichment_results_customgmt_GEM_max10000 <span class="ot">&lt;-</span> <span class="fu">createGEMformat</span>(</span>
<span id="cb42-28"><a href="run-gprofiler-from-r.html#cb42-28" tabindex="-1"></a>                                  enrichment_results_customgmt_max10000,</span>
<span id="cb42-29"><a href="run-gprofiler-from-r.html#cb42-29" tabindex="-1"></a>                                  genesets_baderlab_genesets_max10000, </span>
<span id="cb42-30"><a href="run-gprofiler-from-r.html#cb42-30" tabindex="-1"></a>                                  query_set)</span>
<span id="cb42-31"><a href="run-gprofiler-from-r.html#cb42-31" tabindex="-1"></a></span>
<span id="cb42-32"><a href="run-gprofiler-from-r.html#cb42-32" tabindex="-1"></a><span class="co">#output the enrichment map file</span></span>
<span id="cb42-33"><a href="run-gprofiler-from-r.html#cb42-33" tabindex="-1"></a><span class="fu">write.table</span>(enrichment_results_customgmt_GEM_max10000, </span>
<span id="cb42-34"><a href="run-gprofiler-from-r.html#cb42-34" tabindex="-1"></a>                  <span class="at">file =</span> <span class="fu">file.path</span>(</span>
<span id="cb42-35"><a href="run-gprofiler-from-r.html#cb42-35" tabindex="-1"></a>                    working_dir, <span class="st">&quot;gProfiler_hsapiens_Baderlab_max10000.gem.txt&quot;</span>),</span>
<span id="cb42-36"><a href="run-gprofiler-from-r.html#cb42-36" tabindex="-1"></a>                  <span class="at">row.names =</span> <span class="cn">FALSE</span>, </span>
<span id="cb42-37"><a href="run-gprofiler-from-r.html#cb42-37" tabindex="-1"></a>                  <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,</span>
<span id="cb42-38"><a href="run-gprofiler-from-r.html#cb42-38" tabindex="-1"></a>                  <span class="at">quote =</span> <span class="cn">FALSE</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="setup.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="run-gsea-from-within-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/risserlin/CBW_pathways_workshop_R_notebooks/edit/main/03-Run_gprofiler_in_R.Rmd",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["cbw_workshop_notebooks.pdf", "https://github.com/risserlin/CBW_pathways_workshop_R_notebooks/raw/main/03-Run_gprofiler_in_R.Rmd"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
