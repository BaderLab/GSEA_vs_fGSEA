<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Create GMT file from Ensembl | CBW pathways Workshops - example R notebooks</title>
  <meta name="description" content="These are example R Notebooks to run g:profiler and GSEA and visualize results in Cytoscape with Enrichment map directly from R" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Create GMT file from Ensembl | CBW pathways Workshops - example R notebooks" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These are example R Notebooks to run g:profiler and GSEA and visualize results in Cytoscape with Enrichment map directly from R" />
  <meta name="github-repo" content="risserlin/CBW_pathways_workshop_R_notebooks" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Create GMT file from Ensembl | CBW pathways Workshops - example R notebooks" />
  
  <meta name="twitter:description" content="These are example R Notebooks to run g:profiler and GSEA and visualize results in Cytoscape with Enrichment map directly from R" />
  

<meta name="author" content="Ruth Isserlin" />


<meta name="date" content="2023-03-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="applications.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Workshop R Notebooks</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Index</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> CBW Workshop example R Notebooks</a></li>
<li class="chapter" data-level="3" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>3</b> Setup</a>
<ul>
<li class="chapter" data-level="3.1" data-path="setup.html"><a href="setup.html#docker-optional"><i class="fa fa-check"></i><b>3.1</b> Docker [Optional]</a></li>
<li class="chapter" data-level="3.2" data-path="setup.html"><a href="setup.html#install-docker"><i class="fa fa-check"></i><b>3.2</b> Install Docker</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="setup.html"><a href="setup.html#windows"><i class="fa fa-check"></i><b>3.2.1</b> Windows</a></li>
<li class="chapter" data-level="3.2.2" data-path="setup.html"><a href="setup.html#macos-linux"><i class="fa fa-check"></i><b>3.2.2</b> MacOS / Linux</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>4</b> Methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="methods.html"><a href="methods.html#math-example"><i class="fa fa-check"></i><b>4.1</b> math example</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>5</b> Applications</a>
<ul>
<li class="chapter" data-level="5.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>5.1</b> Example one</a></li>
<li class="chapter" data-level="5.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>5.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html"><i class="fa fa-check"></i><b>6</b> Create GMT file from Ensembl</a>
<ul>
<li class="chapter" data-level="6.1" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html#load-libraries"><i class="fa fa-check"></i><b>6.1</b> Load Libraries</a></li>
<li class="chapter" data-level="6.2" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html#set-up-biomart-connection"><i class="fa fa-check"></i><b>6.2</b> Set up Biomart connection</a></li>
<li class="chapter" data-level="6.3" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html#get-species-go-annotations"><i class="fa fa-check"></i><b>6.3</b> Get species GO annotations</a></li>
<li class="chapter" data-level="6.4" data-path="create-gmt-file-from-ensembl.html"><a href="create-gmt-file-from-ensembl.html#format-results-into-gmt-file"><i class="fa fa-check"></i><b>6.4</b> Format results into GMT file</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CBW pathways Workshops - example R notebooks</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="create-gmt-file-from-ensembl" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Create GMT file from Ensembl<a href="create-gmt-file-from-ensembl.html#create-gmt-file-from-ensembl" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The <a href="https://download.baderlab.org/EM_Genesets/">Baderlab geneset download site</a> is an updated resource for geneset files from GO, Reactome, WikiPathways, Pathbank, NetPath, HumanCyc, IOB, … many others that can be used in <a href="https://biit.cs.ut.ee/gprofiler/gost">g:Profiler</a> or <a href="https://www.gsea-msigdb.org/gsea/index.jsp">GSEA</a> and many other enrichment tools that support the gmt format.</p>
<p>Unfortunately genesets are only supplied for:</p>
<ul>
<li><a href="https://download.baderlab.org/EM_Genesets/current_release/Human/">Human</a></li>
<li><a href="https://download.baderlab.org/EM_Genesets/current_release/Mouse/">Mouse</a></li>
<li><a href="https://download.baderlab.org/EM_Genesets/current_release/Rat/">Rat</a></li>
<li><a href="https://download.baderlab.org/EM_Genesets/current_release/Woodchuck/">Woodchuck</a></li>
</ul>
<p>If you are working in a different species you will need to generate your own gmt file. The best way to do this is through ensembl. Ensembl doesn’t have annotations for all the pathway databases listed above but it has annotations for most species from GO.</p>
<p>The parameters are set in the params option on this notebook but you can also manually set them here.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="create-gmt-file-from-ensembl.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for example - working_dir &lt;- &quot;./genereated_data&quot;</span></span>
<span id="cb3-2"><a href="create-gmt-file-from-ensembl.html#cb3-2" aria-hidden="true" tabindex="-1"></a>working_dir <span class="ot">&lt;-</span> params<span class="sc">$</span>working_dir</span>
<span id="cb3-3"><a href="create-gmt-file-from-ensembl.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="create-gmt-file-from-ensembl.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for example - species &lt;- &quot;horse&quot;</span></span>
<span id="cb3-5"><a href="create-gmt-file-from-ensembl.html#cb3-5" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> params<span class="sc">$</span>species</span>
<span id="cb3-6"><a href="create-gmt-file-from-ensembl.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="create-gmt-file-from-ensembl.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for example - ensembl_dataset &lt;- &quot;ecaballus_gene_ensembl&quot;</span></span>
<span id="cb3-8"><a href="create-gmt-file-from-ensembl.html#cb3-8" aria-hidden="true" tabindex="-1"></a>ensembl_dataset <span class="ot">&lt;-</span> params<span class="sc">$</span>ensembl_dataset</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="create-gmt-file-from-ensembl.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#use library</span></span>
<span id="cb4-2"><a href="create-gmt-file-from-ensembl.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#make sure biocManager is installed</span></span>
<span id="cb4-3"><a href="create-gmt-file-from-ensembl.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="at">expr =</span> { <span class="fu">library</span>(<span class="st">&quot;BiocManager&quot;</span>)}, </span>
<span id="cb4-4"><a href="create-gmt-file-from-ensembl.html#cb4-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">error =</span> <span class="cf">function</span>(e) { </span>
<span id="cb4-5"><a href="create-gmt-file-from-ensembl.html#cb4-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)}, </span>
<span id="cb4-6"><a href="create-gmt-file-from-ensembl.html#cb4-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">finally =</span> <span class="fu">library</span>(<span class="st">&quot;BiocManager&quot;</span>))</span>
<span id="cb4-7"><a href="create-gmt-file-from-ensembl.html#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="create-gmt-file-from-ensembl.html#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="create-gmt-file-from-ensembl.html#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="at">expr =</span> { <span class="fu">library</span>(<span class="st">&quot;biomaRt&quot;</span>)}, </span>
<span id="cb4-10"><a href="create-gmt-file-from-ensembl.html#cb4-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">error =</span> <span class="cf">function</span>(e) { </span>
<span id="cb4-11"><a href="create-gmt-file-from-ensembl.html#cb4-11" aria-hidden="true" tabindex="-1"></a>           BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;biomaRt&quot;</span>)}, </span>
<span id="cb4-12"><a href="create-gmt-file-from-ensembl.html#cb4-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">finally =</span> <span class="fu">library</span>(<span class="st">&quot;biomaRt&quot;</span>))</span></code></pre></div>
<div id="load-libraries" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Load Libraries<a href="create-gmt-file-from-ensembl.html#load-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Create or set a directory to store all the generatd results</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="create-gmt-file-from-ensembl.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(params<span class="sc">$</span>working_dir)){</span>
<span id="cb5-2"><a href="create-gmt-file-from-ensembl.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(params<span class="sc">$</span>working_dir)</span>
<span id="cb5-3"><a href="create-gmt-file-from-ensembl.html#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="set-up-biomart-connection" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Set up Biomart connection<a href="create-gmt-file-from-ensembl.html#set-up-biomart-connection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Connect to Biomart</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="create-gmt-file-from-ensembl.html#cb6-1" aria-hidden="true" tabindex="-1"></a>ensembl <span class="ot">&lt;-</span> <span class="fu">useMart</span>(<span class="st">&quot;ensembl&quot;</span>,<span class="at">host =</span> <span class="st">&quot;https://asia.ensembl.org&quot;</span>)</span></code></pre></div>
<p>Figure out which dataset you want to use - for some species there might be a few datasets to choose from. Not all of the datasets have common namesa associated with them. For example, if you search for ‘yeast’ nothing will be returned but if you look for Saccharomyces or cerevisiae you will be able to find it.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="create-gmt-file-from-ensembl.html#cb7-1" aria-hidden="true" tabindex="-1"></a>all_datasets <span class="ot">&lt;-</span> <span class="fu">listDatasets</span>(ensembl)</span>
<span id="cb7-2"><a href="create-gmt-file-from-ensembl.html#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="create-gmt-file-from-ensembl.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#get all the datasets that match our species definition</span></span>
<span id="cb7-4"><a href="create-gmt-file-from-ensembl.html#cb7-4" aria-hidden="true" tabindex="-1"></a>all_datasets[<span class="fu">grep</span>(all_datasets<span class="sc">$</span>description,</span>
<span id="cb7-5"><a href="create-gmt-file-from-ensembl.html#cb7-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">pattern=</span>species,</span>
<span id="cb7-6"><a href="create-gmt-file-from-ensembl.html#cb7-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ignore.case =</span> <span class="cn">TRUE</span>),]</span></code></pre></div>
<pre><code>##                         dataset                                 description
## 60       ecaballus_gene_ensembl                     Horse genes (EquCab3.0)
## 76          hcomes_gene_ensembl  Tiger tail seahorse genes (H_comes_QL1_v1)
## 164 rferrumequinum_gene_ensembl Greater horseshoe bat genes (mRhiFer1_v1.p)
##            version
## 60       EquCab3.0
## 76  H_comes_QL1_v1
## 164  mRhiFer1_v1.p</code></pre>
<p>If you know the ensembl dataset that you want to use you can specify it in the parameters above or grab from the above table the dataset of the species that you are interested in.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="create-gmt-file-from-ensembl.html#cb9-1" aria-hidden="true" tabindex="-1"></a>ensembl <span class="ot">=</span> <span class="fu">useDataset</span>(ensembl_dataset,<span class="at">mart=</span>ensembl)</span></code></pre></div>
</div>
<div id="get-species-go-annotations" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Get species GO annotations<a href="create-gmt-file-from-ensembl.html#get-species-go-annotations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Get the GO annotations for our species</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="create-gmt-file-from-ensembl.html#cb10-1" aria-hidden="true" tabindex="-1"></a>go_annotation <span class="ot">&lt;-</span> <span class="fu">getBM</span>(<span class="at">attributes =</span> <span class="fu">c</span>(<span class="st">&quot;external_gene_name&quot;</span>,</span>
<span id="cb10-2"><a href="create-gmt-file-from-ensembl.html#cb10-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;ensembl_gene_id&quot;</span>,</span>
<span id="cb10-3"><a href="create-gmt-file-from-ensembl.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;ensembl_transcript_id&quot;</span>,</span>
<span id="cb10-4"><a href="create-gmt-file-from-ensembl.html#cb10-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;go_id&quot;</span>, </span>
<span id="cb10-5"><a href="create-gmt-file-from-ensembl.html#cb10-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;name_1006&quot;</span>, </span>
<span id="cb10-6"><a href="create-gmt-file-from-ensembl.html#cb10-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;namespace_1003&quot;</span>,</span>
<span id="cb10-7"><a href="create-gmt-file-from-ensembl.html#cb10-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;go_linkage_type&quot;</span>), </span>
<span id="cb10-8"><a href="create-gmt-file-from-ensembl.html#cb10-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">filters=</span><span class="fu">list</span>(<span class="at">biotype=</span><span class="st">&#39;protein_coding&#39;</span>), <span class="at">mart=</span>ensembl);</span>
<span id="cb10-9"><a href="create-gmt-file-from-ensembl.html#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="create-gmt-file-from-ensembl.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#get just the go biological process subset</span></span>
<span id="cb10-11"><a href="create-gmt-file-from-ensembl.html#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb10-12"><a href="create-gmt-file-from-ensembl.html#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Get rid of this line if you want to include all of go and not just biological process</span></span>
<span id="cb10-13"><a href="create-gmt-file-from-ensembl.html#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb10-14"><a href="create-gmt-file-from-ensembl.html#cb10-14" aria-hidden="true" tabindex="-1"></a>go_annotation_bp <span class="ot">&lt;-</span> go_annotation[<span class="fu">which</span>(</span>
<span id="cb10-15"><a href="create-gmt-file-from-ensembl.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  go_annotation<span class="sc">$</span>namespace_1003 <span class="sc">==</span> <span class="st">&quot;biological_process&quot;</span>),]</span>
<span id="cb10-16"><a href="create-gmt-file-from-ensembl.html#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="create-gmt-file-from-ensembl.html#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#compute the unique pathway sets</span></span>
<span id="cb10-18"><a href="create-gmt-file-from-ensembl.html#cb10-18" aria-hidden="true" tabindex="-1"></a>go_pathway_sets <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(go_annotation_bp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb10-19"><a href="create-gmt-file-from-ensembl.html#cb10-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">by =</span> <span class="fu">list</span>(go_annotation_bp<span class="sc">$</span>go_id),</span>
<span id="cb10-20"><a href="create-gmt-file-from-ensembl.html#cb10-20" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">list</span>(<span class="fu">unique</span>(x))})</span>
<span id="cb10-21"><a href="create-gmt-file-from-ensembl.html#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="create-gmt-file-from-ensembl.html#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#unlist the go descriptions</span></span>
<span id="cb10-23"><a href="create-gmt-file-from-ensembl.html#cb10-23" aria-hidden="true" tabindex="-1"></a>go_pathway_sets<span class="sc">$</span>name_1006 <span class="ot">&lt;-</span> <span class="fu">apply</span>(go_pathway_sets,<span class="dv">1</span>,<span class="at">FUN=</span><span class="cf">function</span>(x){</span>
<span id="cb10-24"><a href="create-gmt-file-from-ensembl.html#cb10-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">paste</span>(<span class="fu">gsub</span>(<span class="fu">unlist</span>(x<span class="sc">$</span>name_1006),<span class="at">pattern=</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span>,</span>
<span id="cb10-25"><a href="create-gmt-file-from-ensembl.html#cb10-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>),<span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)})</span></code></pre></div>
<p>There are two identifiers that you can choose from in the above table
* external_symbols
* ensembl_ids</p>
<p>Each of these is stored as a list in the dataframe. In order to convert it to the right format for the gmt file we need to convert the list to string of tab delimited strings. (unfortunately there is no streaightforward way to write out a dataframe’s column of lists.)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="create-gmt-file-from-ensembl.html#cb11-1" aria-hidden="true" tabindex="-1"></a>go_pathway_sets[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="st">&quot;external_gene_name&quot;</span>]</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;MEF2A&quot;    &quot;SLC25A36&quot; &quot;OPA1&quot;     &quot;MGME1&quot;    &quot;SLC25A33&quot; &quot;TYMP&quot;     &quot;AKT3&quot;    
## [8] &quot;PIF1&quot;    
## 
## [[2]]
## [1] &quot;GNRH1&quot; &quot;GNRH2&quot; &quot;LIN9&quot; 
## 
## [[3]]
## [1] &quot;ERCC6&quot; &quot;ERCC8&quot; &quot;LIG4&quot;  &quot;APLF&quot;  &quot;APTX&quot;  &quot;XRCC1&quot; &quot;SIRT1&quot; &quot;XNDC1&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="create-gmt-file-from-ensembl.html#cb13-1" aria-hidden="true" tabindex="-1"></a>go_pathway_sets[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="st">&quot;ensembl_gene_id&quot;</span>]</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;ENSECAG00000011593&quot; &quot;ENSECAG00000010094&quot; &quot;ENSECAG00000024248&quot;
## [4] &quot;ENSECAG00000012675&quot; &quot;ENSECAG00000016862&quot; &quot;ENSECAG00000001072&quot;
## [7] &quot;ENSECAG00000019722&quot; &quot;ENSECAG00000005316&quot;
## 
## [[2]]
## [1] &quot;ENSECAG00000010664&quot; &quot;ENSECAG00000039220&quot; &quot;ENSECAG00000014325&quot;
## 
## [[3]]
## [1] &quot;ENSECAG00000014160&quot; &quot;ENSECAG00000018335&quot; &quot;ENSECAG00000003257&quot;
## [4] &quot;ENSECAG00000013246&quot; &quot;ENSECAG00000012674&quot; &quot;ENSECAG00000014127&quot;
## [7] &quot;ENSECAG00000013909&quot; &quot;ENSECAG00000042118&quot;</code></pre>
</div>
<div id="format-results-into-gmt-file" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Format results into GMT file<a href="create-gmt-file-from-ensembl.html#format-results-into-gmt-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Convert column of lists to a tab delimited string of gene names</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="create-gmt-file-from-ensembl.html#cb15-1" aria-hidden="true" tabindex="-1"></a>go_pathway_sets<span class="sc">$</span>collapsed_genenames <span class="ot">&lt;-</span> <span class="fu">apply</span>(go_pathway_sets,<span class="dv">1</span>,</span>
<span id="cb15-2"><a href="create-gmt-file-from-ensembl.html#cb15-2" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">FUN=</span><span class="cf">function</span>(x){</span>
<span id="cb15-3"><a href="create-gmt-file-from-ensembl.html#cb15-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">paste</span>(<span class="fu">gsub</span>(<span class="fu">unlist</span>(x<span class="sc">$</span>external_gene_name),<span class="at">pattern=</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span>,</span>
<span id="cb15-4"><a href="create-gmt-file-from-ensembl.html#cb15-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>),<span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb15-5"><a href="create-gmt-file-from-ensembl.html#cb15-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Convert column of lists to a tab delimited string of gene names</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="create-gmt-file-from-ensembl.html#cb16-1" aria-hidden="true" tabindex="-1"></a>go_pathway_sets<span class="sc">$</span>collapsed_ensemblids <span class="ot">&lt;-</span> <span class="fu">apply</span>(go_pathway_sets,<span class="dv">1</span>,</span>
<span id="cb16-2"><a href="create-gmt-file-from-ensembl.html#cb16-2" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">FUN=</span><span class="cf">function</span>(x){</span>
<span id="cb16-3"><a href="create-gmt-file-from-ensembl.html#cb16-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">paste</span>(<span class="fu">gsub</span>(<span class="fu">unlist</span>(x<span class="sc">$</span>ensembl_gene_id),<span class="at">pattern=</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span>,</span>
<span id="cb16-4"><a href="create-gmt-file-from-ensembl.html#cb16-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>),<span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb16-5"><a href="create-gmt-file-from-ensembl.html#cb16-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>The format of the GMT file is described <a href="here">https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#GMT:<em>Gene_Matrix_Transposed_file_format</em>.28.2A.gmt.29</a> and consists of rows with the following</p>
<ul>
<li>Name</li>
<li>Description</li>
<li>tab delimited list of genes a part of this geneset</li>
</ul>
<p>Write out the gmt file with genenames</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="create-gmt-file-from-ensembl.html#cb17-1" aria-hidden="true" tabindex="-1"></a>gmt_file_genenames <span class="ot">&lt;-</span> go_pathway_sets[,<span class="fu">c</span>(<span class="st">&quot;Group.1&quot;</span>,<span class="st">&quot;name_1006&quot;</span>,</span>
<span id="cb17-2"><a href="create-gmt-file-from-ensembl.html#cb17-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;collapsed_genenames&quot;</span>)]</span>
<span id="cb17-3"><a href="create-gmt-file-from-ensembl.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gmt_file_genenames)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;description&quot;</span>) </span>
<span id="cb17-4"><a href="create-gmt-file-from-ensembl.html#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="create-gmt-file-from-ensembl.html#cb17-5" aria-hidden="true" tabindex="-1"></a>gmt_genenames_filename <span class="ot">&lt;-</span> <span class="fu">file.path</span>(params<span class="sc">$</span>working_dir, <span class="fu">paste</span>(species,ensembl_dataset,<span class="st">&quot;GO_genesets_GN.gmt&quot;</span>,<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb17-6"><a href="create-gmt-file-from-ensembl.html#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="create-gmt-file-from-ensembl.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="at">x =</span> gmt_file_genenames,<span class="at">file =</span> gmt_genenames_filename,</span>
<span id="cb17-8"><a href="create-gmt-file-from-ensembl.html#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-9"><a href="create-gmt-file-from-ensembl.html#cb17-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Write out the gmt file with ensembl ids</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="create-gmt-file-from-ensembl.html#cb18-1" aria-hidden="true" tabindex="-1"></a>gmt_file_ensemblids <span class="ot">&lt;-</span> go_pathway_sets[,<span class="fu">c</span>(<span class="st">&quot;Group.1&quot;</span>,<span class="st">&quot;name_1006&quot;</span>,</span>
<span id="cb18-2"><a href="create-gmt-file-from-ensembl.html#cb18-2" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;collapsed_ensemblids&quot;</span>)]</span>
<span id="cb18-3"><a href="create-gmt-file-from-ensembl.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gmt_file_ensemblids)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>,<span class="st">&quot;description&quot;</span>) </span>
<span id="cb18-4"><a href="create-gmt-file-from-ensembl.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="create-gmt-file-from-ensembl.html#cb18-5" aria-hidden="true" tabindex="-1"></a>gmt_ensemblids_filename <span class="ot">&lt;-</span> <span class="fu">file.path</span>(params<span class="sc">$</span>working_dir, <span class="fu">paste</span>(species,ensembl_dataset,<span class="st">&quot;GO_genesets_esemblids.gmt&quot;</span>,<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb18-6"><a href="create-gmt-file-from-ensembl.html#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="create-gmt-file-from-ensembl.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="at">x =</span> gmt_file_ensemblids,<span class="at">file =</span> gmt_ensemblids_filename,</span>
<span id="cb18-8"><a href="create-gmt-file-from-ensembl.html#cb18-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote =</span> <span class="cn">FALSE</span>,<span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-9"><a href="create-gmt-file-from-ensembl.html#cb18-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>)</span></code></pre></div>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
<span>“What Is a Container?”</span> n.d. <em>Docker</em>. <a href="https://www.docker.com/resources/what-container" class="uri">https://www.docker.com/resources/what-container</a>.
</div>
<div class="csl-entry">
Xie, Yihui. 2015. <em>Dynamic Documents with <span>R</span> and Knitr</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="http://yihui.name/knitr/">http://yihui.name/knitr/</a>.
</div>
<div class="csl-entry">
———. 2023. <em>Bookdown: Authoring Books and Technical Documents with r Markdown</em>. <a href="https://CRAN.R-project.org/package=bookdown">https://CRAN.R-project.org/package=bookdown</a>.
</div>
</div>
</div>
</div>










            </section>

          </div>
        </div>
      </div>
<a href="applications.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-Create_your_own_gmt.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["cbw_workshop_notebooks.pdf", "cbw_workshop_notebooks.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
